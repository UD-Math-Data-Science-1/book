<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.280">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Data Science 1 - 2&nbsp; Descriptive statistics</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./classification.html" rel="next">
<link href="./data.html" rel="prev">
<link href="./_media/logo_small.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script async="" src="https://hypothes.is/embed.js"></script>
<script> 
MathJax = {
  chtml: {
    scale: 0.92,
  }
}
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Descriptive statistics</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto"><div class="quarto-sidebar-header"><div class="sidebar-header-item">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="_media/logo_small.png" height="120" class="figure-img"></p>
</figure>
</div>
</div></div>
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Data Science 1</a> 
        <div class="sidebar-tools-main">
    <a href="./Data-Science-1.pdf" title="Download PDF" class="sidebar-tool px-1"><i class="bi bi-file-pdf"></i></a>
</div>
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">Preface</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">Resources</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Representation of data</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./stats.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Descriptive statistics</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./classification.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Classification</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./selection.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Model selection</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./regression.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Regression</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./clustering.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Clustering</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./networks.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Networks</span></a>
  </div>
</li>
    </ul>
    </div>
<div class="quarto-sidebar-footer"><div class="sidebar-footer-item">
<p>Copyright 2023 by Toby Driscoll</p>
</div></div></nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#summary-statistics" id="toc-summary-statistics" class="nav-link active" data-scroll-target="#summary-statistics"><span class="toc-section-number">2.1</span>  Summary statistics</a>
  <ul class="collapse">
  <li><a href="#mean-and-dispersion" id="toc-mean-and-dispersion" class="nav-link" data-scroll-target="#mean-and-dispersion"><span class="toc-section-number">2.1.1</span>  Mean and dispersion</a></li>
  <li><a href="#z-scores" id="toc-z-scores" class="nav-link" data-scroll-target="#z-scores"><span class="toc-section-number">2.1.2</span>  z-scores</a></li>
  <li><a href="#populations-and-samples" id="toc-populations-and-samples" class="nav-link" data-scroll-target="#populations-and-samples"><span class="toc-section-number">2.1.3</span>  Populations and samples</a></li>
  <li><a href="#median-and-quantiles" id="toc-median-and-quantiles" class="nav-link" data-scroll-target="#median-and-quantiles"><span class="toc-section-number">2.1.4</span>  Median and quantiles</a></li>
  </ul></li>
  <li><a href="#distributions" id="toc-distributions" class="nav-link" data-scroll-target="#distributions"><span class="toc-section-number">2.2</span>  Distributions</a>
  <ul class="collapse">
  <li><a href="#cdf" id="toc-cdf" class="nav-link" data-scroll-target="#cdf"><span class="toc-section-number">2.2.1</span>  CDF</a></li>
  <li><a href="#empirical-cdf" id="toc-empirical-cdf" class="nav-link" data-scroll-target="#empirical-cdf"><span class="toc-section-number">2.2.2</span>  Empirical CDF</a></li>
  <li><a href="#pdf" id="toc-pdf" class="nav-link" data-scroll-target="#pdf"><span class="toc-section-number">2.2.3</span>  PDF</a></li>
  <li><a href="#mean-and-variance" id="toc-mean-and-variance" class="nav-link" data-scroll-target="#mean-and-variance"><span class="toc-section-number">2.2.4</span>  Mean and variance</a></li>
  <li><a href="#normal-distribution" id="toc-normal-distribution" class="nav-link" data-scroll-target="#normal-distribution"><span class="toc-section-number">2.2.5</span>  Normal distribution</a></li>
  </ul></li>
  <li><a href="#grouping-data" id="toc-grouping-data" class="nav-link" data-scroll-target="#grouping-data"><span class="toc-section-number">2.3</span>  Grouping data</a>
  <ul class="collapse">
  <li><a href="#splitting" id="toc-splitting" class="nav-link" data-scroll-target="#splitting"><span class="toc-section-number">2.3.1</span>  Splitting</a></li>
  <li><a href="#aggregation" id="toc-aggregation" class="nav-link" data-scroll-target="#aggregation"><span class="toc-section-number">2.3.2</span>  Aggregation</a></li>
  <li><a href="#transformation" id="toc-transformation" class="nav-link" data-scroll-target="#transformation"><span class="toc-section-number">2.3.3</span>  Transformation</a></li>
  <li><a href="#filtering" id="toc-filtering" class="nav-link" data-scroll-target="#filtering"><span class="toc-section-number">2.3.4</span>  Filtering</a></li>
  </ul></li>
  <li><a href="#outliers" id="toc-outliers" class="nav-link" data-scroll-target="#outliers"><span class="toc-section-number">2.4</span>  Outliers</a>
  <ul class="collapse">
  <li><a href="#iqr" id="toc-iqr" class="nav-link" data-scroll-target="#iqr"><span class="toc-section-number">2.4.1</span>  IQR</a></li>
  <li><a href="#mean-and-std" id="toc-mean-and-std" class="nav-link" data-scroll-target="#mean-and-std"><span class="toc-section-number">2.4.2</span>  Mean and STD</a></li>
  <li><a href="#removing-outliers" id="toc-removing-outliers" class="nav-link" data-scroll-target="#removing-outliers"><span class="toc-section-number">2.4.3</span>  Removing outliers</a></li>
  </ul></li>
  <li><a href="#correlation" id="toc-correlation" class="nav-link" data-scroll-target="#correlation"><span class="toc-section-number">2.5</span>  Correlation</a>
  <ul class="collapse">
  <li><a href="#relational-plots" id="toc-relational-plots" class="nav-link" data-scroll-target="#relational-plots"><span class="toc-section-number">2.5.1</span>  Relational plots</a></li>
  <li><a href="#covariance" id="toc-covariance" class="nav-link" data-scroll-target="#covariance"><span class="toc-section-number">2.5.2</span>  Covariance</a></li>
  <li><a href="#pearson-coefficient" id="toc-pearson-coefficient" class="nav-link" data-scroll-target="#pearson-coefficient"><span class="toc-section-number">2.5.3</span>  Pearson coefficient</a></li>
  <li><a href="#spearman-coefficient" id="toc-spearman-coefficient" class="nav-link" data-scroll-target="#spearman-coefficient"><span class="toc-section-number">2.5.4</span>  Spearman coefficient</a></li>
  <li><a href="#categorical-correlation" id="toc-categorical-correlation" class="nav-link" data-scroll-target="#categorical-correlation"><span class="toc-section-number">2.5.5</span>  Categorical correlation</a></li>
  </ul></li>
  <li><a href="#cautionary-tales" id="toc-cautionary-tales" class="nav-link" data-scroll-target="#cautionary-tales"><span class="toc-section-number">2.6</span>  Cautionary tales</a>
  <ul class="collapse">
  <li><a href="#anscombes-quartet" id="toc-anscombes-quartet" class="nav-link" data-scroll-target="#anscombes-quartet"><span class="toc-section-number">2.6.1</span>  Anscombe’s quartet</a></li>
  <li><a href="#simpsons-paradox" id="toc-simpsons-paradox" class="nav-link" data-scroll-target="#simpsons-paradox"><span class="toc-section-number">2.6.2</span>  Simpson’s paradox</a></li>
  </ul></li>
  <li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises">Exercises</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Descriptive statistics</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<div>
<div class="hidden">
<p><span class="math display">\[
    \newcommand{\float}{\mathbb{F}}
    \newcommand{\real}{\mathbb{R}}
    \newcommand{\complex}{\mathbb{C}}
    \newcommand{\nat}{\mathbb{N}}
    \newcommand{\integer}{\mathbb{Z}}
    \newcommand{\bfa}{\mathbf{a}}
    \newcommand{\bfe}{\mathbf{e}}
    \newcommand{\bfh}{\mathbf{h}}
    \newcommand{\bfp}{\mathbf{p}}
    \newcommand{\bfq}{\mathbf{q}}
    \newcommand{\bfu}{\mathbf{u}}
    \newcommand{\bfv}{\mathbf{v}}
    \newcommand{\bfw}{\mathbf{w}}
    \newcommand{\bfx}{\mathbf{x}}
    \newcommand{\bfy}{\mathbf{y}}
    \newcommand{\bfz}{\mathbf{z}}
    \newcommand{\bfA}{\mathbf{A}}
    \newcommand{\bfW}{\mathbf{W}}
    \newcommand{\bfX}{\mathbf{X}}
    \newcommand{\bfzero}{\boldsymbol{0}}
    \newcommand{\bfmu}{\boldsymbol{\mu}}
    \newcommand{\TP}{\text{TP}}
    \newcommand{\TN}{\text{TN}}
    \newcommand{\FP}{\text{FP}}
    \newcommand{\FN}{\text{FN}}
    \newcommand{\rmn}[2]{\mathbb{R}^{#1 \times #2}}
    \newcommand{\dd}[2]{\frac{d #1}{d #2}}
    \newcommand{\pp}[2]{\frac{\partial #1}{\partial #2}}
    \newcommand{\norm}[1]{\left\lVert \mathstrut #1 \right\rVert}
    \newcommand{\abs}[1]{\left\lvert \mathstrut #1 \right\rvert}
    \newcommand{\twonorm}[1]{\norm{#1}_2}
    \newcommand{\onenorm}[1]{\norm{#1}_1}
    \newcommand{\infnorm}[1]{\norm{#1}_\infty}
    \newcommand{\innerprod}[2]{\langle #1,#2 \rangle}
    \newcommand{\pr}[1]{^{(#1)}}
    \newcommand{\diag}{\operatorname{diag}}
    \newcommand{\sign}{\operatorname{sign}}
    \newcommand{\dist}{\operatorname{dist}}
    \newcommand{\simil}{\operatorname{sim}}
    \newcommand{\ee}{\times 10^}
    \newcommand{\floor}[1]{\lfloor#1\rfloor}
    \newcommand{\argmin}{\operatorname{argmin}}
    \newcommand{\E}[1]{\operatorname{\mathbb{E}}\left[\mathstrut #1\right]}
    \newcommand{\Cov}{\operatorname{Cov}}
    \newcommand{\logit}{\operatorname{logit}}
\]</span></p>
</div>
</div>
<p>When confronted with a new dataset, it’s crucial to get a sense of its characteristics before attempting to draw conclusions or predictions from it.</p>
<p>One of the fastest ways to become familiar with a data set is to visualize it. Python has many graphics packages with different niches. The most widespread is <strong>Matplotlib</strong>, which is fairly low-level in the sense that you must explicitly specify most aspects of how the plots will look.</p>
<p>We will make extensive use of <strong>seaborn</strong>, which is built on top of Matplotlib. It’s meant to be used at a higher level, i.e., letting you describe what you want to see and making it look pretty good. (It is possible to customize seaborn plots using Matplotlib commands, but we won’t need much of that.)</p>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>There are three major plot types within seaborn:</p>
<dl>
<dt><code>displot</code></dt>
<dd>
How values of a single variable are distributed.
</dd>
<dt><code>catplot</code></dt>
<dd>
How categorical values are distributed within and across categories.
</dd>
<dt><code>relplot</code></dt>
<dd>
How values of two variables are related to each other.
</dd>
</dl>
<section id="summary-statistics" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="summary-statistics"><span class="header-section-number">2.1</span> Summary statistics</h2>
<p>We will use data about car fuel efficiency for illustrations.</p>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>cars <span class="op">=</span> sns.load_dataset(<span class="st">"mpg"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code>describe</code> method of a data frame gives summary statistics for each column of quantitative data:</p>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>cars.describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>mpg</th>
      <th>cylinders</th>
      <th>displacement</th>
      <th>horsepower</th>
      <th>weight</th>
      <th>acceleration</th>
      <th>model_year</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>398.000000</td>
      <td>398.000000</td>
      <td>398.000000</td>
      <td>392.000000</td>
      <td>398.000000</td>
      <td>398.000000</td>
      <td>398.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>23.514573</td>
      <td>5.454774</td>
      <td>193.425879</td>
      <td>104.469388</td>
      <td>2970.424623</td>
      <td>15.568090</td>
      <td>76.010050</td>
    </tr>
    <tr>
      <th>std</th>
      <td>7.815984</td>
      <td>1.701004</td>
      <td>104.269838</td>
      <td>38.491160</td>
      <td>846.841774</td>
      <td>2.757689</td>
      <td>3.697627</td>
    </tr>
    <tr>
      <th>min</th>
      <td>9.000000</td>
      <td>3.000000</td>
      <td>68.000000</td>
      <td>46.000000</td>
      <td>1613.000000</td>
      <td>8.000000</td>
      <td>70.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>17.500000</td>
      <td>4.000000</td>
      <td>104.250000</td>
      <td>75.000000</td>
      <td>2223.750000</td>
      <td>13.825000</td>
      <td>73.000000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>23.000000</td>
      <td>4.000000</td>
      <td>148.500000</td>
      <td>93.500000</td>
      <td>2803.500000</td>
      <td>15.500000</td>
      <td>76.000000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>29.000000</td>
      <td>8.000000</td>
      <td>262.000000</td>
      <td>126.000000</td>
      <td>3608.000000</td>
      <td>17.175000</td>
      <td>79.000000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>46.600000</td>
      <td>8.000000</td>
      <td>455.000000</td>
      <td>230.000000</td>
      <td>5140.000000</td>
      <td>24.800000</td>
      <td>82.000000</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>We now discuss the definitions and interpretations of these values.</p>
<section id="mean-and-dispersion" class="level3" data-number="2.1.1">
<h3 data-number="2.1.1" class="anchored" data-anchor-id="mean-and-dispersion"><span class="header-section-number">2.1.1</span> Mean and dispersion</h3>
<p>You may already know the “big three” summary statistics:</p>
<div id="def-stats-meanvarstd" class="theorem definition">
<p><span class="theorem-title"><strong>Definition 2.1 </strong></span>Given data values <span class="math inline">\(x_1,\ldots,x_n\)</span>, their <strong>mean</strong> is <span id="eq-stats-mean"><span class="math display">\[
\mu = \frac{1}{n}\sum_{i=1}^n x_i,
\tag{2.1}\]</span></span> their <strong>variance</strong> is <span id="eq-stats-var"><span class="math display">\[
\sigma^2 = \frac{1}{n}\sum_{i=1}^n (x_i - \mu)^2,
\tag{2.2}\]</span></span> and their <strong>standard deviation</strong> (STD) is <span class="math inline">\(\sigma\)</span>, the square root of the variance.</p>
</div>
<p>Mean is a measurement of central tendency. Variance and STD are measures of spread or <em>dispersion</em> in the data.</p>
<div id="exm-stats-maxvar" class="theorem example">
<p><span class="theorem-title"><strong>Example 2.1 </strong></span>Suppose that <span class="math inline">\(x_1=0\)</span>, <span class="math inline">\(x_2=t\)</span>, and <span class="math inline">\(x_3=-t\)</span>, where <span class="math inline">\(|t| \le 5\)</span>. What are the minimum and maximum possible values of the standard deviation?</p>
<div class="solution proof">
<p><span class="proof-title"><em>Solution</em>. </span>The mean is <span class="math inline">\(\mu=0\)</span>, and hence <span class="math display">\[
\sigma^2 = 0^2 + t^2 + (-t)^2 = 2t^2.
\]</span> The function <span class="math inline">\(f(t)=2t^2\)</span> has a single critical value at <span class="math inline">\(t=0\)</span>. Clearly, <span class="math inline">\(f(0)=0\)</span> is both a local and a global minimum. Since <span class="math inline">\(-5\le t \le 5\)</span>, we also find that <span class="math inline">\(f(\pm5)=50\)</span> is a global maximum.</p>
</div>
</div>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Variance is in units that are the square of the data, which can be harder to interpret than STD, which has units the same as the data values.</p>
</div>
</div>
</section>
<section id="z-scores" class="level3" data-number="2.1.2">
<h3 data-number="2.1.2" class="anchored" data-anchor-id="z-scores"><span class="header-section-number">2.1.2</span> z-scores</h3>
<p>Given data values <span class="math inline">\(x_1,\ldots,x_n\)</span>, we can define related values known as <strong>standardized scores</strong> or <strong>z-scores</strong>:</p>
<p><span class="math display">\[
z_i = \frac{x-\mu}{\sigma}, \ldots i=1,\ldots,n.
\]</span></p>
<p>The z-scores have mean zero and standard deviation equal to 1; in physical terms, they are dimensionless. This makes them attractive to work with and compare across data sets.</p>
<div id="thm-stats-zscores" class="theorem">
<p><span class="theorem-title"><strong>Theorem 2.1 </strong></span>The z-scores have mean equal to zero and variance equal to 1.</p>
</div>
<div class="proof">
<p><span class="proof-title"><em>Proof</em>. </span>Direct calculations.</p>
</div>
<div id="exm-stats-zscores" class="theorem example">
<p><span class="theorem-title"><strong>Example 2.2 </strong></span>Continuing with the values from <a href="#exm-stats-maxvar">Example&nbsp;<span>2.1</span></a>, we assume without losing generality that <span class="math inline">\(t\ge 0\)</span>. (Otherwise, we can just swap <span class="math inline">\(x_2\)</span> and <span class="math inline">\(x_3\)</span>.) Then we have the z-scores <span class="math display">\[
z_1 = \frac{0-0}{t\sqrt{2}} = 0, \quad z_2 = \frac{t-0}{t\sqrt{2}} = \frac{1}{\sqrt{2}} \quad z_3 = \frac{-t-0}{t\sqrt{2}} = \frac{-1}{\sqrt{2}}.
\]</span> These are independent of <span class="math inline">\(t\)</span>, which just scales the original values. So, for instance, the z-scores of a collection of distances are unaffected if the distances are expressed in centimeters or kilometers.</p>
</div>
<p>We can write a little function to compute z-scores in Python:</p>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> standardize(x):</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (x <span class="op">-</span> x.mean()) <span class="op">/</span> x.std()</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>cars[<span class="st">"mpg_z"</span>] <span class="op">=</span> standardize( cars[<span class="st">"mpg"</span>] )</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>cars[ [<span class="st">"mpg"</span>, <span class="st">"mpg_z"</span>] ].describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>mpg</th>
      <th>mpg_z</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>398.000000</td>
      <td>3.980000e+02</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>23.514573</td>
      <td>1.071170e-16</td>
    </tr>
    <tr>
      <th>std</th>
      <td>7.815984</td>
      <td>1.000000e+00</td>
    </tr>
    <tr>
      <th>min</th>
      <td>9.000000</td>
      <td>-1.857037e+00</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>17.500000</td>
      <td>-7.695221e-01</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>23.000000</td>
      <td>-6.583596e-02</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>29.000000</td>
      <td>7.018217e-01</td>
    </tr>
    <tr>
      <th>max</th>
      <td>46.600000</td>
      <td>2.953617e+00</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="callout-caution callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Danger
</div>
</div>
<div class="callout-body-container callout-body">
<p>Since floating-point values are rounded off, it’s unlikely that a value derived from them that is meant to be zero will actually be exactly zero. Above, the mean value of about <span class="math inline">\(-10^{-15}\)</span> should be seen as reasonable for values that have been rounded off in the 15th digit or so.</p>
</div>
</div>
</section>
<section id="populations-and-samples" class="level3" data-number="2.1.3">
<h3 data-number="2.1.3" class="anchored" data-anchor-id="populations-and-samples"><span class="header-section-number">2.1.3</span> Populations and samples</h3>
<p>In statistics one refers to the <strong>population</strong> as the entire universe of available values. Thus, the ages of adult on Earth at some instant has a particular population mean and standard deviation. However, in order to estimate those values, we can only measure a <strong>sample</strong> of the population directly.</p>
<p>When <a href="#eq-stats-mean">Equation&nbsp;<span>2.1</span></a> is used to compute the mean of a sample rather than a population, we change the notation a bit as a reminder: <span id="eq-stats-mean-sample"><span class="math display">\[
\bar{x} = \frac{1}{n}\sum_{i=1}^n x_i.
\tag{2.3}\]</span></span></p>
<p>It can be proved that the sample mean is an accurate way to estimate the population mean, in the following precise sense. If, in a thought experiment, we could average <span class="math inline">\(\bar{x}\)</span> over all possible samples of size <span class="math inline">\(n\)</span>, the result would be exactly the population mean <span class="math inline">\(\mu\)</span>. That is, we say that <span class="math inline">\(\bar{x}\)</span> is an <strong>unbiased estimator</strong> for <span class="math inline">\(\mu\)</span>.</p>
<p>The sample mean in turn can be used within <a href="#eq-stats-var">Equation&nbsp;<span>2.2</span></a> to compute <strong>sample variance</strong>: <span class="math display">\[
s_n^2 = \frac{1}{n}\sum_{i=1}^n (x_i - \bar{x})^2.
\]</span></p>
<p>However, sample variance is more subtle than the sample mean. If <span class="math inline">\(s_n^2\)</span> is averaged over all possible sample sets, we do <em>not</em> get the population variance <span class="math inline">\(\sigma^2\)</span>; hence, <span class="math inline">\(s_n^2\)</span> is called a <strong>biased estimator</strong> of the population variance.</p>
<p>An unbiased estimator for <span class="math inline">\(\sigma^2\)</span> is</p>
<p><span id="eq-stats-var-sample"><span class="math display">\[
s_{n-1}^2 = \frac{1}{n-1}\sum_{i=1}^n (x_i - \bar{x})^2.
\tag{2.4}\]</span></span></p>
<div id="exm-stats-sample" class="theorem example">
<p><span class="theorem-title"><strong>Example 2.3 </strong></span>The values [1, 4, 9, 16, 25] have mean <span class="math inline">\(\bar{x}=55/5 = 11\)</span>. The sample variance is</p>
<p><span class="math display">\[
\begin{split}
    s_n^2 &amp;= \frac{(1-11)^2+(4-11)^2+(9-11)^2+(16-11)^2+(25-11)^2}{5} \\
    &amp; = \frac{374}{5} = 74.8.
\end{split}
\]</span></p>
<p>By contrast, the unbiased estimate of population variance from this sample is</p>
<p><span class="math display">\[
s_{n-1}^2 = \frac{374}{4} = 93.5.
\]</span></p>
</div>
<p>As you can see from the formulas and the example, the sample variance is always too large as an estimator, but the difference vanishes as the sample size <span class="math inline">\(n\)</span> increases.</p>
<div class="callout-warning callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>Sources are not always clear about this terminology. Some use <em>sample variance</em> to mean <span class="math inline">\(s_{n-1}^2\)</span>, not <span class="math inline">\(s_n^2\)</span>, and many even omit the subscripts. You always have to check each source.</p>
</div>
</div>
<div class="callout-caution callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Danger
</div>
</div>
<div class="callout-body-container callout-body">
<p>NumPy computes the biased estimator of variance by default, while pandas computes the unbiased version. Whee! Fortunately, most datasets today have large enough <span class="math inline">\(n\)</span> to make the difference negligible.</p>
</div>
</div>
<p>For standard deviation, <em>neither</em> <span class="math inline">\(s_n\)</span> <em>nor</em> <span class="math inline">\(s_{n-1}\)</span> is an unbiased estimator of <span class="math inline">\(\sigma\)</span>. There is no simple correction that works for all distributions. Our practice is to use <span class="math inline">\(s_{n-1}\)</span>, which is what <code>std</code> computes in pandas. Thus, for instance, a <strong>sample z-score</strong> for <span class="math inline">\(x_i\)</span> is</p>
<p><span id="eq-stats-t-score"><span class="math display">\[
z_i = \frac{x_i-\bar{x}}{s_{n-1}}.
\tag{2.5}\]</span></span></p>
<!-- :::{.callout-important}
In statistics, @eq-stats-t-score is referred to as a *t-score*, and the term *sample z-score* is not common. In data science practice, however, the sample sizes are usually so large that the difference between z-scores and t-scores is rarely important. Most sources just use the term *z-score* indiscriminately.
::: -->
</section>
<section id="median-and-quantiles" class="level3" data-number="2.1.4">
<h3 data-number="2.1.4" class="anchored" data-anchor-id="median-and-quantiles"><span class="header-section-number">2.1.4</span> Median and quantiles</h3>
<p>Mean and variance are not the most relevant summary statistics for every dataset. There are important alternatives.</p>
<div id="def-stats-percentile" class="theorem definition">
<p><span class="theorem-title"><strong>Definition 2.2 </strong></span>For any <span class="math inline">\(0 &lt; p &lt; 1\)</span>, the <span class="math inline">\(100p\)</span>-<strong>percentile</strong> is the value of <span class="math inline">\(x\)</span> such that <span class="math inline">\(p\)</span> is the probability of observing a population value less than or equal to <span class="math inline">\(x\)</span>.</p>
<p>The 50th percentile is known as the <strong>median</strong> of the population.</p>
</div>
<p>In other words, percentiles are the inverse function of the CDF.</p>
<p>The unbiased sample median of <span class="math inline">\(x_1,\ldots,x_n\)</span> can be computed by sorting the values into <span class="math inline">\(y_1,\ldots,y_n\)</span>. If <span class="math inline">\(n\)</span> is odd, then <span class="math inline">\(y_{(n+1)/2}\)</span> is the sample median; otherwise, the average of <span class="math inline">\(y_{n/2}\)</span> and <span class="math inline">\(y_{1+(n/2)}\)</span> is the sample median.</p>
<p>Computing unbiased sample estimates of percentiles other than the median is complicated, and we won’t go into the details. For large datasets, the sample values are good estimators in practice.</p>
<div id="exm-stats-median" class="theorem example">
<p><span class="theorem-title"><strong>Example 2.4 </strong></span>If the sorted values are <span class="math inline">\(1,3,3,4,5,5,5\)</span>, then <span class="math inline">\(n=7\)</span> and the sample median is <span class="math inline">\(y_4=4\)</span>. If the sample values are <span class="math inline">\(1,3,3,4,5,5,5,9\)</span>, then <span class="math inline">\(n=8\)</span> and the sample median is <span class="math inline">\((4+5)/2=4.5\)</span>.</p>
</div>
<p>A set of percentiles dividing probability into <span class="math inline">\(q\)</span> equal pieces is called the <span class="math inline">\(q\)</span>–<strong>quantiles</strong>.</p>
<div id="exm-stats-quartiles" class="theorem example">
<p><span class="theorem-title"><strong>Example 2.5 </strong></span>The 4-quantiles are called <strong>quartiles</strong>. The first quartile is the 25th percentile, or the value that exceeds 1/4 of the population. The second quartile is the median. The third quartile is the 75th percentile.</p>
<p>Sometimes the definition is extended to the <em>zeroth quartile</em>, which is the minimum sample value, and the <em>fourth quartile</em>, which is the maximum sample value.</p>
</div>
<div class="callout-caution callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Danger
</div>
</div>
<div class="callout-body-container callout-body">
<p>If this all isn’t confusing enough yet, sometimes the word <em>quantile</em> is used to mean <em>percentile</em>. This is the case for the <code>quantile</code> method in pandas.</p>
</div>
</div>
<div id="def-stats-IQR" class="theorem definition">
<p><span class="theorem-title"><strong>Definition 2.3 </strong></span>The <strong>interquartile range</strong> (IQR) is the difference between the 75th percentile and the 25th percentile.</p>
</div>
<p>IQR is an indication of the spread of the values. For some distributions, the median and IQR might be a good substitute for the mean and standard deviation.</p>
<div id="exm-data-describe" class="theorem example">
<p><span class="theorem-title"><strong>Example 2.6 </strong></span>The <code>describe</code> method includes mean, standard deviation, and the quartiles.</p>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> numpy.random <span class="im">import</span> default_rng</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>rng <span class="op">=</span> default_rng(<span class="dv">19716</span>)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame( {</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"normal"</span> : rng.normal( size<span class="op">=</span>(<span class="dv">4000</span>,) ),</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"uniform"</span> : rng.uniform( size<span class="op">=</span>(<span class="dv">4000</span>,) )</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    } )</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>df.describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>normal</th>
      <th>uniform</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>4000.000000</td>
      <td>4000.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>-0.026801</td>
      <td>0.493338</td>
    </tr>
    <tr>
      <th>std</th>
      <td>0.995135</td>
      <td>0.293177</td>
    </tr>
    <tr>
      <th>min</th>
      <td>-3.361732</td>
      <td>0.000257</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>-0.685307</td>
      <td>0.232339</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>-0.017852</td>
      <td>0.486322</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>0.633775</td>
      <td>0.750565</td>
    </tr>
    <tr>
      <th>max</th>
      <td>3.115486</td>
      <td>0.999204</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="distributions" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="distributions"><span class="header-section-number">2.2</span> Distributions</h2>
<p>Mean and dispersion (variance or STD) attempt to summarize quantitative data with a couple of numbers. At the other extreme, we can express the distribution of all values precisely using a function.</p>
<section id="cdf" class="level3" data-number="2.2.1">
<h3 data-number="2.2.1" class="anchored" data-anchor-id="cdf"><span class="header-section-number">2.2.1</span> CDF</h3>
<div id="def-data-cdf" class="theorem definition">
<p><span class="theorem-title"><strong>Definition 2.4 </strong></span>The <strong>cumulative distribution function</strong> (CDF) of a population is the function <span class="math display">\[
F(t) = \text{fraction of the population that is less than or equal to $t$},
\]</span> where <span class="math inline">\(t\)</span> ranges over all possible values.</p>
</div>
<p>Note that by its definition, <span class="math inline">\(F\)</span> ranges between 0 and 1 (inclusive) and is a nondecreasing function.</p>
<div id="exm-data-uniform-discrete" class="theorem example">
<p><span class="theorem-title"><strong>Example 2.7 </strong></span>If a population is <span class="math inline">\(x_i=i\)</span> for <span class="math inline">\(i=1,\ldots,n\)</span>, then <span class="math inline">\(F(k)=k/n\)</span> at each <span class="math inline">\(k=1,\ldots,n\)</span>. We could, however, also regard <span class="math inline">\(F\)</span> as a function of a continuous variable <span class="math inline">\(t\)</span>, in which case <span class="math display">\[
F(t) = \frac{\lfloor t \rfloor}{n},
\]</span> where <span class="math inline">\(\lfloor\cdot\rfloor\)</span> is the <em>floor function</em> that rounds leftward to the nearest integer. This produces a step function that looks like stairs going up from 0 to 1.</p>
</div>
<p><a href="#exm-data-uniform-discrete">Example&nbsp;<span>2.7</span></a> becomes interesting as a template for generalizing to infinite populations. If we take not <span class="math inline">\(x_i=i\)</span> but <span class="math inline">\(x_i=i/n\)</span> and then let <span class="math inline">\(n\to \infty\)</span>, then the graph of <span class="math inline">\(F\)</span> converges to <span id="eq-data-uniform-cdf"><span class="math display">\[
F(t) = \begin{cases}
0, &amp; t &lt; 0, \\
t,&amp; 0 \le t \le 1, \\
1,&amp; t &gt; 1.
\end{cases}
\tag{2.6}\]</span></span> While it doesn’t make sense to think about a fraction of the number of values in the infinite case, we can interpret <span class="math inline">\(F(t)\)</span> as the *probability of observing a value less than or equal to the real number <span class="math inline">\(t\)</span>.</p>
<div id="def-data-uniform-cdf" class="theorem definition">
<p><span class="theorem-title"><strong>Definition 2.5 </strong></span>A <strong>uniform distribution</strong> gives an equal probability to every value. In particular, the uniform distribution over the interval <span class="math inline">\([0,1]\)</span> has the CDF given in <a href="#eq-data-uniform-cdf">Equation&nbsp;<span>2.6</span></a>.</p>
</div>
</section>
<section id="empirical-cdf" class="level3" data-number="2.2.2">
<h3 data-number="2.2.2" class="anchored" data-anchor-id="empirical-cdf"><span class="header-section-number">2.2.2</span> Empirical CDF</h3>
<p>Given a sample of a population, we can always calculate the analog of a CDF from its values.</p>
<div id="def-stats-ecdf" class="theorem definition">
<p><span class="theorem-title"><strong>Definition 2.6 </strong></span>The <strong>empirical cumulative distribution function</strong> or ECDF of a sample is the function <span class="math inline">\(\hat{F}\)</span> whose value at <span class="math inline">\(t\)</span> equals the proportion of the sample values that are less than or equal to <span class="math inline">\(t\)</span>.</p>
</div>
<div id="exm-stats-ecdf-uniform" class="theorem example">
<p><span class="theorem-title"><strong>Example 2.8 </strong></span>Here is an experiment that producing the ECDF for a sample from the random number generator:</p>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> numpy.random <span class="im">import</span> default_rng</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>rng <span class="op">=</span> default_rng(<span class="dv">19716</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> rng.uniform( size<span class="op">=</span>(<span class="dv">100</span>,) )</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>sns.displot(x, kind<span class="op">=</span><span class="st">"ecdf"</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="stats_files/figure-html/cell-7-output-1.png" width="469" height="469"></p>
</div>
</div>
<p>If we take more samples, we expect to see a curve closer to the theoretical CDF, <span class="math inline">\(F(t)=t\)</span>:</p>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> rng.uniform( size<span class="op">=</span>(<span class="dv">4000</span>,) )</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>sns.displot(x, kind<span class="op">=</span><span class="st">"ecdf"</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="stats_files/figure-html/cell-8-output-1.png" width="469" height="469"></p>
</div>
</div>
</div>
</section>
<section id="pdf" class="level3" data-number="2.2.3">
<h3 data-number="2.2.3" class="anchored" data-anchor-id="pdf"><span class="header-section-number">2.2.3</span> PDF</h3>
<p>By definition, we know that if <span class="math inline">\(a&lt;b\)</span>, <span class="math inline">\(\hat{F}(b) - \hat{F}(a)\)</span> is the number of observations in the half-open interval <span class="math inline">\((a,b]\)</span>. This leads into the next definition.</p>
<div id="def-data-histogram" class="theorem definition">
<p><span class="theorem-title"><strong>Definition 2.7 </strong></span>Select the ordered values <span class="math inline">\(t_1 &lt; t_2 &lt; \cdots &lt; t_m\)</span>, called <strong>edges</strong>, and define <strong>bins</strong> as the intervals <span class="math display">\[
B_k = (t_k,t_{k+1}], \qquad k=0,\ldots,m,
\]</span> where we adopt the convention that <span class="math inline">\(t_0=-\infty\)</span> and <span class="math inline">\(t_{m+1}=\infty\)</span>. Let <span class="math inline">\(c_k\)</span> be the number of data values in <span class="math inline">\(B_k\)</span>. Then a <strong>histogram</strong> relative to the bins is the list of <span class="math inline">\((B_0,c_0),\ldots,(B_m,c_m)\)</span>.</p>
</div>
<p>The default for a seaborn <code>displot</code> is to show a histogram.</p>
<div id="exm-data-uniform-hist" class="theorem example">
<p><span class="theorem-title"><strong>Example 2.9 </strong></span>Continuing with the uniform distribution over <span class="math inline">\([0,1]\)</span>:</p>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> rng.uniform( size<span class="op">=</span>(<span class="dv">1000</span>,) )</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>sns.displot(x)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="stats_files/figure-html/cell-9-output-1.png" width="469" height="469"></p>
</div>
</div>
<p>We can choose the number of bins to use, or give a vector of their edges:</p>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>sns.displot(x, bins<span class="op">=</span><span class="dv">40</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="stats_files/figure-html/cell-10-output-1.png" width="469" height="469"></p>
</div>
</div>
</div>
<p>Again something interesting happens in a limiting case. If we normalize the count in a bin by the length of that bin, we get <span id="eq-data-pdf"><span class="math display">\[
\frac{c_k}{t_{k+1}-t_k} = \frac{\hat{F}(t_{k+1})-\hat{F}(t_k)}{t_{k+1}-t_k}.
\tag{2.7}\]</span></span> If we let the number of observations tend to infinity, then <span class="math inline">\(\hat{F}\)</span> will converge to <span class="math inline">\(F\)</span>, and if we also let the number of bins go to infinity, then the fraction in <a href="#eq-data-pdf">Equation&nbsp;<span>2.7</span></a> converges to <span class="math inline">\(F'(t_k)\)</span>.</p>
<div id="def-data-pdf" class="theorem definition">
<p><span class="theorem-title"><strong>Definition 2.8 </strong></span>The <strong>probability density function</strong> or PDF of a distribution is the derivative of the CDF.</p>
</div>
<div id="exm-data-uniform-pdf" class="theorem example">
<p><span class="theorem-title"><strong>Example 2.10 </strong></span>If we have many samples, then we can use a normalized histogram to give an approximation of the PDF:</p>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> rng.uniform( size<span class="op">=</span>(<span class="dv">20000</span>,) )</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>sns.displot(x, bins<span class="op">=</span><span class="dv">24</span>, stat<span class="op">=</span><span class="st">"density"</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="stats_files/figure-html/cell-11-output-1.png" width="469" height="469"></p>
</div>
</div>
<p>Alternatively, we can use process called <em>kernel density estimation</em> to plot a continuous estimate of the PDF:</p>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>sns.displot(x, kind<span class="op">=</span><span class="st">"kde"</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="stats_files/figure-html/cell-12-output-1.png" width="469" height="469"></p>
</div>
</div>
<p>In this case we did not obtain a particularly good approximation of the true PDF. In part this is because kernel density estimation assumes that the PDF is continuous, but here it is 1 over <span class="math inline">\([0,1]\)</span> and jumps down to 0 elsewhere.</p>
</div>
</section>
<section id="mean-and-variance" class="level3" data-number="2.2.4">
<h3 data-number="2.2.4" class="anchored" data-anchor-id="mean-and-variance"><span class="header-section-number">2.2.4</span> Mean and variance</h3>
<p>It’s possible to compute the mean and variance (thus STD) of a distribution from its PDF: <span class="math display">\[
\begin{split}
\mu &amp;= \int x f(x) \, dx \\
\sigma^2 &amp;= \int (x-\mu)^2 f(x) \, dx,
\end{split}
\]</span> where the integrals are taken over the domain of <span class="math inline">\(f\)</span>.</p>
<div id="exm-stats-uniform-mean" class="theorem example">
<p><span class="theorem-title"><strong>Example 2.11 </strong></span>The uniform distribution over <span class="math inline">\([0,1]\)</span> has <span class="math inline">\(f(x)=1\)</span> over that interval. Hence, <span class="math display">\[
\begin{split}
\mu &amp;= \int_0^1 x \, dx = \left[ \frac{1}{2} x^2\right]_0^1 = \frac{1}{2}, \\
\sigma^2 &amp;= \int_0^1 \left(x-\tfrac{1}{2}\right)^2 \, dx = \frac{1}{3} - \frac{1}{2} + \frac{1}{4} = \frac{1}{12}.
\end{split}
\]</span></p>
<p>Let’s check these results empirically:</p>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> numpy.random <span class="im">import</span> default_rng</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>rng <span class="op">=</span> default_rng(<span class="dv">19716</span>)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> rng.uniform( size<span class="op">=</span>(<span class="dv">2000</span>,) )</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"µ = </span><span class="sc">{</span>np<span class="sc">.</span>mean(x)<span class="sc">:.5f}</span><span class="ss">, 12σ² = </span><span class="sc">{</span><span class="dv">12</span><span class="op">*</span>np<span class="sc">.</span>var(x)<span class="sc">:.5f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>µ = 0.50518, 12σ² = 1.00019</code></pre>
</div>
</div>
</div>
</section>
<section id="normal-distribution" class="level3" data-number="2.2.5">
<h3 data-number="2.2.5" class="anchored" data-anchor-id="normal-distribution"><span class="header-section-number">2.2.5</span> Normal distribution</h3>
<p>Next to perhaps the uniform distribution, the following is the most widely used distribution of a random variable.</p>
<div id="def-stats-normal" class="theorem definition">
<p><span class="theorem-title"><strong>Definition 2.9 </strong></span>The <strong>normal distribution</strong> or <em>Gaussian distribution</em> with mean <span class="math inline">\(\mu\)</span> and variance <span class="math inline">\(\sigma^2\)</span> is defined by the PDF <span id="eq-stats-normal"><span class="math display">\[
f(x) = \frac{1}{\sigma \sqrt{2\pi}} e^{ -(x-\mu)^2/(2\sigma^2)}.
\tag{2.8}\]</span></span> The <strong>standard normal</strong> distribution uses <span class="math inline">\(\mu=0\)</span> and <span class="math inline">\(\sigma=1\)</span>.</p>
</div>
<p>For data that are distributed normally, about 68% of the values lie within one standard deviation of the mean, and 95% lie within two standard deviations.</p>
<div id="exm-stats-normal" class="theorem example">
<p><span class="theorem-title"><strong>Example 2.12 </strong></span>The <code>normal</code> method of a NumPy RNG simulates a standard normal distribution.</p>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>rng <span class="op">=</span> default_rng(<span class="dv">19716</span>)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> rng.normal( size<span class="op">=</span>(<span class="dv">10000</span>,) )</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>sns.displot(x, bins<span class="op">=</span>np.linspace(<span class="op">-</span><span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">28</span>), stat<span class="op">=</span><span class="st">"probability"</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="stats_files/figure-html/cell-14-output-1.png" width="469" height="469"></p>
</div>
</div>
<p>We can change the variance by multiplication by <span class="math inline">\(\sigma\)</span> and change the mean by adding <span class="math inline">\(\mu\)</span>:</p>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame( {<span class="st">"x"</span>: x, <span class="st">"3x-10"</span>: <span class="dv">3</span><span class="op">*</span>x<span class="op">-</span><span class="dv">10</span>} )</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>df.describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>x</th>
      <th>3x-10</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>10000.000000</td>
      <td>10000.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>-0.012414</td>
      <td>-10.037242</td>
    </tr>
    <tr>
      <th>std</th>
      <td>0.993568</td>
      <td>2.980704</td>
    </tr>
    <tr>
      <th>min</th>
      <td>-3.436924</td>
      <td>-20.310773</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>-0.672352</td>
      <td>-12.017056</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>-0.008374</td>
      <td>-10.025122</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>0.659730</td>
      <td>-8.020809</td>
    </tr>
    <tr>
      <th>max</th>
      <td>4.044099</td>
      <td>2.132297</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>The KDE density estimator works pretty well for normally distributed data, except in the tails where there are few observations:</p>
<div class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>sns.displot(data<span class="op">=</span>df, x<span class="op">=</span><span class="st">"3x-10"</span>, kind<span class="op">=</span><span class="st">"kde"</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="stats_files/figure-html/cell-16-output-1.png" width="469" height="468"></p>
</div>
</div>
</div>
</section>
</section>
<section id="grouping-data" class="level2 page-columns page-full" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="grouping-data"><span class="header-section-number">2.3</span> Grouping data</h2>
<p>Sometimes we are interested in breaking down data by categorical values or other criteria. Both seaborn and pandas make this relatively straightforward.</p>
<p>Here is the distribution of the <em>mpg</em> variable over the entire dataset:</p>
<div class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>sns.displot(data<span class="op">=</span>cars, x<span class="op">=</span><span class="st">"mpg"</span>, bins<span class="op">=</span><span class="dv">20</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="stats_files/figure-html/cell-17-output-1.png" width="469" height="468"></p>
</div>
</div>
<p>We now look at ways to group the samples within this dataset.</p>
<section id="splitting" class="level3 page-columns page-full" data-number="2.3.1">
<h3 data-number="2.3.1" class="anchored" data-anchor-id="splitting"><span class="header-section-number">2.3.1</span> Splitting</h3>
<p>We can use categorical variables to define groups within the data set. Suppose we want to separate by the <em>origin</em> column:</p>
<div class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>cars[<span class="st">"origin"</span>].value_counts()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<pre><code>usa       249
japan      79
europe     70
Name: origin, dtype: int64</code></pre>
</div>
</div>
<p>The <code>groupby</code> method for a data frame splits the frame into groups based on categorical values in a designated column:</p>
<div class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>cars.groupby([<span class="st">"origin"</span>])[<span class="st">"mpg"</span>].describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="18">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>count</th>
      <th>mean</th>
      <th>std</th>
      <th>min</th>
      <th>25%</th>
      <th>50%</th>
      <th>75%</th>
      <th>max</th>
    </tr>
    <tr>
      <th>origin</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>europe</th>
      <td>70.0</td>
      <td>27.891429</td>
      <td>6.723930</td>
      <td>16.2</td>
      <td>24.0</td>
      <td>26.5</td>
      <td>30.65</td>
      <td>44.3</td>
    </tr>
    <tr>
      <th>japan</th>
      <td>79.0</td>
      <td>30.450633</td>
      <td>6.090048</td>
      <td>18.0</td>
      <td>25.7</td>
      <td>31.6</td>
      <td>34.05</td>
      <td>46.6</td>
    </tr>
    <tr>
      <th>usa</th>
      <td>249.0</td>
      <td>20.083534</td>
      <td>6.402892</td>
      <td>9.0</td>
      <td>15.0</td>
      <td>18.5</td>
      <td>24.00</td>
      <td>39.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>Both the median and the mean values are quite a bit lower for <em>usa</em> cars than for the other regions. This is also apparent when we plot the distributions individually using different colors:</p>
<div class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>sns.displot(cars, x<span class="op">=</span><span class="st">"mpg"</span>, hue<span class="op">=</span><span class="st">"origin"</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="stats_files/figure-html/cell-20-output-1.png" width="572" height="468"></p>
</div>
</div>
<p>That graph might be hard to read because of the overlaps. We can instead plot the groups in separate columns in what is often called a <em>facet plot</em>:</p>
<div class="cell page-columns page-full" data-execution_count="21">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>sns.displot(cars, </span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">"mpg"</span>, </span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>    col<span class="op">=</span><span class="st">"origin"</span>, height<span class="op">=</span><span class="fl">2.2</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display column-body-outset">
<p><img src="stats_files/figure-html/cell-21-output-1.png" width="623" height="199"></p>
</div>
</div>
<p>It’s now clear that the U.S.A. cars are more clustered on the left (smaller MPG) than are the Japanese and European cars.</p>
<p>Another way to visualize grouped data is with a <strong>box plot</strong>:</p>
<div class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>sns.catplot(cars, </span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">"origin"</span>, y<span class="op">=</span><span class="st">"mpg"</span>, </span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>    kind<span class="op">=</span><span class="st">"box"</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="stats_files/figure-html/cell-22-output-1.png" width="469" height="468"></p>
</div>
</div>
<p>Each colored box shows the interquartile range, with the interior horizontal line showing the median. The whiskers and dots are explained in a later section. A related visualization is a <strong>violin plot</strong>:</p>
<div class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>sns.catplot(cars, </span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">"mpg"</span>, y<span class="op">=</span><span class="st">"origin"</span>, </span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    kind<span class="op">=</span><span class="st">"violin"</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="stats_files/figure-html/cell-23-output-1.png" width="469" height="468"></p>
</div>
</div>
<p>In a violin plot, the inner lines show the same information as the box plot, with the thick part showing the IQR, while the sides of the “violins” are KDE estimates of the density functions.</p>
<p>It’s also possible to split using a quantitative variable. The <code>cut</code> method will put the values into bins that serve to define the groups:</p>
<div class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>cuts <span class="op">=</span> pd.cut( </span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>    cars[<span class="st">"weight"</span>],         <span class="co"># series to cut by</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">range</span>(<span class="dv">1500</span>, <span class="dv">5800</span>, <span class="dv">1000</span>)    <span class="co"># bin edges</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>cars[<span class="st">"cuts"</span>] <span class="op">=</span> cuts</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>cars.head(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="23">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>mpg</th>
      <th>cylinders</th>
      <th>displacement</th>
      <th>horsepower</th>
      <th>weight</th>
      <th>acceleration</th>
      <th>model_year</th>
      <th>origin</th>
      <th>name</th>
      <th>mpg_z</th>
      <th>cuts</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>18.0</td>
      <td>8</td>
      <td>307.0</td>
      <td>130.0</td>
      <td>3504</td>
      <td>12.0</td>
      <td>70</td>
      <td>usa</td>
      <td>chevrolet chevelle malibu</td>
      <td>-0.705551</td>
      <td>(3500, 4500]</td>
    </tr>
    <tr>
      <th>1</th>
      <td>15.0</td>
      <td>8</td>
      <td>350.0</td>
      <td>165.0</td>
      <td>3693</td>
      <td>11.5</td>
      <td>70</td>
      <td>usa</td>
      <td>buick skylark 320</td>
      <td>-1.089379</td>
      <td>(3500, 4500]</td>
    </tr>
    <tr>
      <th>2</th>
      <td>18.0</td>
      <td>8</td>
      <td>318.0</td>
      <td>150.0</td>
      <td>3436</td>
      <td>11.0</td>
      <td>70</td>
      <td>usa</td>
      <td>plymouth satellite</td>
      <td>-0.705551</td>
      <td>(2500, 3500]</td>
    </tr>
    <tr>
      <th>3</th>
      <td>16.0</td>
      <td>8</td>
      <td>304.0</td>
      <td>150.0</td>
      <td>3433</td>
      <td>12.0</td>
      <td>70</td>
      <td>usa</td>
      <td>amc rebel sst</td>
      <td>-0.961437</td>
      <td>(2500, 3500]</td>
    </tr>
    <tr>
      <th>4</th>
      <td>17.0</td>
      <td>8</td>
      <td>302.0</td>
      <td>140.0</td>
      <td>3449</td>
      <td>10.5</td>
      <td>70</td>
      <td>usa</td>
      <td>ford torino</td>
      <td>-0.833494</td>
      <td>(2500, 3500]</td>
    </tr>
    <tr>
      <th>5</th>
      <td>15.0</td>
      <td>8</td>
      <td>429.0</td>
      <td>198.0</td>
      <td>4341</td>
      <td>10.0</td>
      <td>70</td>
      <td>usa</td>
      <td>ford galaxie 500</td>
      <td>-1.089379</td>
      <td>(3500, 4500]</td>
    </tr>
    <tr>
      <th>6</th>
      <td>14.0</td>
      <td>8</td>
      <td>454.0</td>
      <td>220.0</td>
      <td>4354</td>
      <td>9.0</td>
      <td>70</td>
      <td>usa</td>
      <td>chevrolet impala</td>
      <td>-1.217322</td>
      <td>(3500, 4500]</td>
    </tr>
    <tr>
      <th>7</th>
      <td>14.0</td>
      <td>8</td>
      <td>440.0</td>
      <td>215.0</td>
      <td>4312</td>
      <td>8.5</td>
      <td>70</td>
      <td>usa</td>
      <td>plymouth fury iii</td>
      <td>-1.217322</td>
      <td>(3500, 4500]</td>
    </tr>
    <tr>
      <th>8</th>
      <td>14.0</td>
      <td>8</td>
      <td>455.0</td>
      <td>225.0</td>
      <td>4425</td>
      <td>10.0</td>
      <td>70</td>
      <td>usa</td>
      <td>pontiac catalina</td>
      <td>-1.217322</td>
      <td>(3500, 4500]</td>
    </tr>
    <tr>
      <th>9</th>
      <td>15.0</td>
      <td>8</td>
      <td>390.0</td>
      <td>190.0</td>
      <td>3850</td>
      <td>8.5</td>
      <td>70</td>
      <td>usa</td>
      <td>amc ambassador dpl</td>
      <td>-1.089379</td>
      <td>(3500, 4500]</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>sns.catplot(cars, </span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">"mpg"</span>, y<span class="op">=</span><span class="st">"cuts"</span>, </span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>    kind<span class="op">=</span><span class="st">"violin"</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="stats_files/figure-html/cell-25-output-1.png" width="470" height="468"></p>
</div>
</div>
</section>
<section id="aggregation" class="level3" data-number="2.3.2">
<h3 data-number="2.3.2" class="anchored" data-anchor-id="aggregation"><span class="header-section-number">2.3.2</span> Aggregation</h3>
<p>Groups defined by <code>groupby</code> can then be passed through <em>aggregators</em> that reduce each grouped column to a single value. A list of the most common predefined aggregation functions is given in <a href="#tbl-stats-agg">Table&nbsp;<span>2.1</span></a>.</p>
<div id="tbl-stats-agg" class="anchored">
<table class="table">
<caption>Table&nbsp;2.1: Aggregation functions. All ignore <code>NaN</code> values.</caption>
<thead>
<tr class="header">
<th>method</th>
<th>effect</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>count</code></td>
<td>Number of values in each group</td>
</tr>
<tr class="even">
<td><code>mean</code></td>
<td>Mean value in each group</td>
</tr>
<tr class="odd">
<td><code>sum</code></td>
<td>Sum within each group</td>
</tr>
<tr class="even">
<td><code>std</code>, <code>var</code></td>
<td>Standard deviation/variance within groups</td>
</tr>
<tr class="odd">
<td><code>min</code>, <code>max</code></td>
<td>Min or max within groups</td>
</tr>
<tr class="even">
<td><code>describe</code></td>
<td>Descriptive statistics</td>
</tr>
<tr class="odd">
<td><code>first</code>, <code>last</code></td>
<td>First or last of group values</td>
</tr>
</tbody>
</table>
</div>
<div class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>by_weight <span class="op">=</span> cars.groupby(cuts)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>by_weight[<span class="st">"mpg"</span>].describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="25">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>count</th>
      <th>mean</th>
      <th>std</th>
      <th>min</th>
      <th>25%</th>
      <th>50%</th>
      <th>75%</th>
      <th>max</th>
    </tr>
    <tr>
      <th>weight</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>(1500, 2500]</th>
      <td>147.0</td>
      <td>30.631293</td>
      <td>5.864413</td>
      <td>18.0</td>
      <td>26.0</td>
      <td>30.5</td>
      <td>34.450</td>
      <td>46.6</td>
    </tr>
    <tr>
      <th>(2500, 3500]</th>
      <td>142.0</td>
      <td>22.547183</td>
      <td>4.754061</td>
      <td>13.0</td>
      <td>19.0</td>
      <td>22.0</td>
      <td>25.325</td>
      <td>38.0</td>
    </tr>
    <tr>
      <th>(3500, 4500]</th>
      <td>92.0</td>
      <td>15.688043</td>
      <td>2.760428</td>
      <td>10.0</td>
      <td>14.0</td>
      <td>15.0</td>
      <td>17.125</td>
      <td>26.6</td>
    </tr>
    <tr>
      <th>(4500, 5500]</th>
      <td>17.0</td>
      <td>12.411765</td>
      <td>1.622453</td>
      <td>9.0</td>
      <td>12.0</td>
      <td>13.0</td>
      <td>13.000</td>
      <td>16.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>If you want a more exotic operation, you can call <code>agg</code> with your own function:</p>
<div class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> iqr(x):</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>    q1,q3 <span class="op">=</span> x.quantile( [<span class="fl">.25</span>, <span class="fl">.75</span>] )</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> q3 <span class="op">-</span> q1</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>by_weight[<span class="st">"mpg"</span>].agg(iqr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="26">
<pre><code>weight
(1500, 2500]    8.450
(2500, 3500]    6.325
(3500, 4500]    3.125
(4500, 5500]    1.000
Name: mpg, dtype: float64</code></pre>
</div>
</div>
</section>
<section id="transformation" class="level3 page-columns page-full" data-number="2.3.3">
<h3 data-number="2.3.3" class="anchored" data-anchor-id="transformation"><span class="header-section-number">2.3.3</span> Transformation</h3>
<p>A transformation applies a function to each element of a column, producing a result of the same length that can be indexed the same way. This transformation can be applied group by group.</p>
<p>For example, we can standardize to z-scores within each group separately:</p>
<div class="cell page-columns page-full" data-execution_count="28">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> standardize(x):</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (x <span class="op">-</span> x.mean()) <span class="op">/</span> x.std()</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>cars[<span class="st">"group_z"</span>] <span class="op">=</span> by_weight[<span class="st">"mpg"</span>].transform(standardize)</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>sns.displot(cars, </span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">"group_z"</span>, </span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>    col<span class="op">=</span><span class="st">"origin"</span>, height<span class="op">=</span><span class="fl">2.3</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display column-body-outset">
<p><img src="stats_files/figure-html/cell-28-output-1.png" width="652" height="208"></p>
</div>
</div>
<p>Note how this differs from computing z-scores based on global statistics:</p>
<div class="cell page-columns page-full" data-execution_count="29">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>cars[<span class="st">"global_z"</span>] <span class="op">=</span> standardize( cars[<span class="st">"mpg"</span>] )</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>sns.displot(cars, </span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">"global_z"</span>, </span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>    col<span class="op">=</span><span class="st">"origin"</span>, height<span class="op">=</span><span class="fl">2.3</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display column-body-outset">
<p><img src="stats_files/figure-html/cell-29-output-1.png" width="652" height="208"></p>
</div>
</div>
</section>
<section id="filtering" class="level3" data-number="2.3.4">
<h3 data-number="2.3.4" class="anchored" data-anchor-id="filtering"><span class="header-section-number">2.3.4</span> Filtering</h3>
<p>To apply a filter, provide a function that operates on a column and returns either <code>True</code>, meaning to keep the column, or <code>False</code>, meaning to reject it. This filter is applied groupwise.</p>
<p>For example, suppose we want to group cars by horsepower:</p>
<div class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>cuts <span class="op">=</span> pd.cut(cars[<span class="st">"horsepower"</span>], <span class="bu">range</span>(<span class="dv">40</span>,<span class="dv">220</span>,<span class="dv">20</span>))</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>by_hp <span class="op">=</span> cars.groupby(cuts)</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>by_hp.count()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="29">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>mpg</th>
      <th>cylinders</th>
      <th>displacement</th>
      <th>horsepower</th>
      <th>weight</th>
      <th>acceleration</th>
      <th>model_year</th>
      <th>origin</th>
      <th>name</th>
      <th>mpg_z</th>
      <th>cuts</th>
      <th>group_z</th>
      <th>global_z</th>
    </tr>
    <tr>
      <th>horsepower</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>(40, 60]</th>
      <td>20</td>
      <td>20</td>
      <td>20</td>
      <td>20</td>
      <td>20</td>
      <td>20</td>
      <td>20</td>
      <td>20</td>
      <td>20</td>
      <td>20</td>
      <td>20</td>
      <td>20</td>
      <td>20</td>
    </tr>
    <tr>
      <th>(60, 80]</th>
      <td>99</td>
      <td>99</td>
      <td>99</td>
      <td>99</td>
      <td>99</td>
      <td>99</td>
      <td>99</td>
      <td>99</td>
      <td>99</td>
      <td>99</td>
      <td>99</td>
      <td>99</td>
      <td>99</td>
    </tr>
    <tr>
      <th>(80, 100]</th>
      <td>123</td>
      <td>123</td>
      <td>123</td>
      <td>123</td>
      <td>123</td>
      <td>123</td>
      <td>123</td>
      <td>123</td>
      <td>123</td>
      <td>123</td>
      <td>123</td>
      <td>123</td>
      <td>123</td>
    </tr>
    <tr>
      <th>(100, 120]</th>
      <td>48</td>
      <td>48</td>
      <td>48</td>
      <td>48</td>
      <td>48</td>
      <td>48</td>
      <td>48</td>
      <td>48</td>
      <td>48</td>
      <td>48</td>
      <td>48</td>
      <td>48</td>
      <td>48</td>
    </tr>
    <tr>
      <th>(120, 140]</th>
      <td>25</td>
      <td>25</td>
      <td>25</td>
      <td>25</td>
      <td>25</td>
      <td>25</td>
      <td>25</td>
      <td>25</td>
      <td>25</td>
      <td>25</td>
      <td>25</td>
      <td>25</td>
      <td>25</td>
    </tr>
    <tr>
      <th>(140, 160]</th>
      <td>40</td>
      <td>40</td>
      <td>40</td>
      <td>40</td>
      <td>40</td>
      <td>40</td>
      <td>40</td>
      <td>40</td>
      <td>40</td>
      <td>40</td>
      <td>40</td>
      <td>40</td>
      <td>40</td>
    </tr>
    <tr>
      <th>(160, 180]</th>
      <td>20</td>
      <td>20</td>
      <td>20</td>
      <td>20</td>
      <td>20</td>
      <td>20</td>
      <td>20</td>
      <td>20</td>
      <td>20</td>
      <td>20</td>
      <td>20</td>
      <td>20</td>
      <td>20</td>
    </tr>
    <tr>
      <th>(180, 200]</th>
      <td>7</td>
      <td>7</td>
      <td>7</td>
      <td>7</td>
      <td>7</td>
      <td>7</td>
      <td>7</td>
      <td>7</td>
      <td>7</td>
      <td>7</td>
      <td>7</td>
      <td>7</td>
      <td>7</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>Say we want to drop the cars belonging to groups having fewer than 30 members:</p>
<div class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>hp_30 <span class="op">=</span> by_hp.<span class="bu">filter</span>( <span class="kw">lambda</span> x: <span class="bu">len</span>(x) <span class="op">&gt;</span> <span class="dv">29</span> )</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>hp_30.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="30">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>mpg</th>
      <th>cylinders</th>
      <th>displacement</th>
      <th>horsepower</th>
      <th>weight</th>
      <th>acceleration</th>
      <th>model_year</th>
      <th>origin</th>
      <th>name</th>
      <th>mpg_z</th>
      <th>cuts</th>
      <th>group_z</th>
      <th>global_z</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2</th>
      <td>18.0</td>
      <td>8</td>
      <td>318.0</td>
      <td>150.0</td>
      <td>3436</td>
      <td>11.0</td>
      <td>70</td>
      <td>usa</td>
      <td>plymouth satellite</td>
      <td>-0.705551</td>
      <td>(2500, 3500]</td>
      <td>-0.956484</td>
      <td>-0.705551</td>
    </tr>
    <tr>
      <th>3</th>
      <td>16.0</td>
      <td>8</td>
      <td>304.0</td>
      <td>150.0</td>
      <td>3433</td>
      <td>12.0</td>
      <td>70</td>
      <td>usa</td>
      <td>amc rebel sst</td>
      <td>-0.961437</td>
      <td>(2500, 3500]</td>
      <td>-1.377177</td>
      <td>-0.961437</td>
    </tr>
    <tr>
      <th>11</th>
      <td>14.0</td>
      <td>8</td>
      <td>340.0</td>
      <td>160.0</td>
      <td>3609</td>
      <td>8.0</td>
      <td>70</td>
      <td>usa</td>
      <td>plymouth 'cuda 340</td>
      <td>-1.217322</td>
      <td>(3500, 4500]</td>
      <td>-0.611515</td>
      <td>-1.217322</td>
    </tr>
    <tr>
      <th>12</th>
      <td>15.0</td>
      <td>8</td>
      <td>400.0</td>
      <td>150.0</td>
      <td>3761</td>
      <td>9.5</td>
      <td>70</td>
      <td>usa</td>
      <td>chevrolet monte carlo</td>
      <td>-1.089379</td>
      <td>(3500, 4500]</td>
      <td>-0.249252</td>
      <td>-1.089379</td>
    </tr>
    <tr>
      <th>14</th>
      <td>24.0</td>
      <td>4</td>
      <td>113.0</td>
      <td>95.0</td>
      <td>2372</td>
      <td>15.0</td>
      <td>70</td>
      <td>japan</td>
      <td>toyota corona mark ii</td>
      <td>0.062107</td>
      <td>(1500, 2500]</td>
      <td>-1.130768</td>
      <td>0.062107</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>Notice that the result has been merged back into a single frame. If we want to work with the groups again, we have to apply the grouping anew.</p>
<div class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>cuts <span class="op">=</span> pd.cut(hp_30[<span class="st">"horsepower"</span>], <span class="bu">range</span>(<span class="dv">40</span>,<span class="dv">220</span>,<span class="dv">20</span>))</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>hp_30.groupby(cuts)[<span class="st">"mpg"</span>].median()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="31">
<pre><code>horsepower
(40, 60]        NaN
(60, 80]      31.00
(80, 100]     23.80
(100, 120]    20.40
(120, 140]      NaN
(140, 160]    14.25
(160, 180]      NaN
(180, 200]      NaN
Name: mpg, dtype: float64</code></pre>
</div>
</div>
<!-- 

You can simultaneously use columns for one category with colors for another:

::: {.cell .column-body-outset execution_count=33}
``` {.python .cell-code}
sns.displot(data=cars, x="mpg", col="origin",
    hue="cylinders", multiple="stack", height=2.5
    );
```

::: {.cell-output .cell-output-display}
![](stats_files/figure-html/cell-33-output-1.png){width=788 height=227}
:::
:::


Also note in the above that we asked to stack bars rather than overlap them. Other options to designate different groups are `size` and `style` (marker type). -->
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>There is a balance to strike between a plot that is information-poor versus one that is too busy to read clearly. But you can probably fit more information comfortably than you have been accustomed to. Great data visualizations reward time spent by the reader to examine them. <a href="https://www.edwardtufte.com/tufte/">Edward Tufte</a> has written several great books on this subject.</p>
</div>
</div>

<!-- ## Split–apply–combine

One of the most important workflows in data analysis is called **split–apply–combine**:

1. Split the data into groups based on a criterion (e.g., species, marital status).
2. Apply operations to the data within each group.
3. Combine the results from the groups.

Of these, the *apply* step is typically the most complex. In fact, in pandas you rarely need to perform step 3 explicitly, as it's usually automatic.

### Split

For illustrations, we will load a dataset supplied with seaborn. 

::: {.cell execution_count=34}
``` {.python .cell-code}
import pandas as pd
import seaborn as sns

penguins = sns.load_dataset("penguins")
penguins
```

::: {.cell-output .cell-output-display execution_count=33}

```{=html}
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>species</th>
      <th>island</th>
      <th>bill_length_mm</th>
      <th>bill_depth_mm</th>
      <th>flipper_length_mm</th>
      <th>body_mass_g</th>
      <th>sex</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Adelie</td>
      <td>Torgersen</td>
      <td>39.1</td>
      <td>18.7</td>
      <td>181.0</td>
      <td>3750.0</td>
      <td>Male</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Adelie</td>
      <td>Torgersen</td>
      <td>39.5</td>
      <td>17.4</td>
      <td>186.0</td>
      <td>3800.0</td>
      <td>Female</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Adelie</td>
      <td>Torgersen</td>
      <td>40.3</td>
      <td>18.0</td>
      <td>195.0</td>
      <td>3250.0</td>
      <td>Female</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Adelie</td>
      <td>Torgersen</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Adelie</td>
      <td>Torgersen</td>
      <td>36.7</td>
      <td>19.3</td>
      <td>193.0</td>
      <td>3450.0</td>
      <td>Female</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>339</th>
      <td>Gentoo</td>
      <td>Biscoe</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>340</th>
      <td>Gentoo</td>
      <td>Biscoe</td>
      <td>46.8</td>
      <td>14.3</td>
      <td>215.0</td>
      <td>4850.0</td>
      <td>Female</td>
    </tr>
    <tr>
      <th>341</th>
      <td>Gentoo</td>
      <td>Biscoe</td>
      <td>50.4</td>
      <td>15.7</td>
      <td>222.0</td>
      <td>5750.0</td>
      <td>Male</td>
    </tr>
    <tr>
      <th>342</th>
      <td>Gentoo</td>
      <td>Biscoe</td>
      <td>45.2</td>
      <td>14.8</td>
      <td>212.0</td>
      <td>5200.0</td>
      <td>Female</td>
    </tr>
    <tr>
      <th>343</th>
      <td>Gentoo</td>
      <td>Biscoe</td>
      <td>49.9</td>
      <td>16.1</td>
      <td>213.0</td>
      <td>5400.0</td>
      <td>Male</td>
    </tr>
  </tbody>
</table>
<p>344 rows × 7 columns</p>
</div>
```

:::
:::


::: {.cell execution_count=35}
``` {.python .cell-code}
by_species = penguins.groupby("species")
```
:::


In computer science, this is what is called a *lazy* operation: nothing is actually done yet to the data frame. It's just set up for applying future operations to each group.

::: {.cell execution_count=36}
``` {.python .cell-code}
for name,group in by_species:
    print(name)
    print(group.iloc[:3,:4])
    print()
```

::: {.cell-output .cell-output-stdout}
```
Adelie
  species     island  bill_length_mm  bill_depth_mm
0  Adelie  Torgersen            39.1           18.7
1  Adelie  Torgersen            39.5           17.4
2  Adelie  Torgersen            40.3           18.0

Chinstrap
       species island  bill_length_mm  bill_depth_mm
152  Chinstrap  Dream            46.5           17.9
153  Chinstrap  Dream            50.0           19.5
154  Chinstrap  Dream            51.3           19.2

Gentoo
    species  island  bill_length_mm  bill_depth_mm
220  Gentoo  Biscoe            46.1           13.2
221  Gentoo  Biscoe            50.0           16.3
222  Gentoo  Biscoe            48.7           14.1

```
:::
:::


### Apply

The most complex step is applying operations to each group of data. There are three types of operations in pandas:

Aggregation
: Summarizing data by a single value, such as a sum or mean, or by a few values, such as value counts or quintiles.

Transformation
: Application of a mathematical operation to every data value, resulting in data indexed the same way as the original. For example, quantitative data might be transformed to lie in the interval $[0,1]$.

Filtration
: Inclusion/removal of a group based on a criterion, such as rejection of a group with too few members.

As a rule of thumb, aggregation produces a single numerical result from a series, transformation changes the series to another one of the same length, and filtering extracts a subset of a series. -->
</section>
</section>
<section id="outliers" class="level2" data-number="2.4">
<h2 data-number="2.4" class="anchored" data-anchor-id="outliers"><span class="header-section-number">2.4</span> Outliers</h2>
<p>Informally, an <strong>outlier</strong> is a data value that is considered to be far from typical. In some applications, such as detecting earthquakes or cancer, outliers are the cases of real interest. But we will be thinking of them as unwelcome values that might result from equipment failure, confounding effects, mistyping a value, using an extreme value to represent missing data, and so on. In such cases we want to minimize the effect of the outliers on the statistics.</p>
<p>There are various ways of deciding what “typical” means, and there is no one-size recommendation for all applications.</p>
<section id="iqr" class="level3" data-number="2.4.1">
<h3 data-number="2.4.1" class="anchored" data-anchor-id="iqr"><span class="header-section-number">2.4.1</span> IQR</h3>
<p>Let’s look at another data set, based on an fMRI experiment.</p>
<div class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>fmri <span class="op">=</span> sns.load_dataset(<span class="st">"fmri"</span>)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>fmri.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="36">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>subject</th>
      <th>timepoint</th>
      <th>event</th>
      <th>region</th>
      <th>signal</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>s13</td>
      <td>18</td>
      <td>stim</td>
      <td>parietal</td>
      <td>-0.017552</td>
    </tr>
    <tr>
      <th>1</th>
      <td>s5</td>
      <td>14</td>
      <td>stim</td>
      <td>parietal</td>
      <td>-0.080883</td>
    </tr>
    <tr>
      <th>2</th>
      <td>s12</td>
      <td>18</td>
      <td>stim</td>
      <td>parietal</td>
      <td>-0.081033</td>
    </tr>
    <tr>
      <th>3</th>
      <td>s11</td>
      <td>18</td>
      <td>stim</td>
      <td>parietal</td>
      <td>-0.046134</td>
    </tr>
    <tr>
      <th>4</th>
      <td>s10</td>
      <td>18</td>
      <td>stim</td>
      <td>parietal</td>
      <td>-0.037970</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>We want to focus on the <em>signal</em> column, splitting according to the <em>event</em>.</p>
<div class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>fmri.groupby(<span class="st">"event"</span>)[<span class="st">"signal"</span>].describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="37">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>count</th>
      <th>mean</th>
      <th>std</th>
      <th>min</th>
      <th>25%</th>
      <th>50%</th>
      <th>75%</th>
      <th>max</th>
    </tr>
    <tr>
      <th>event</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>cue</th>
      <td>532.0</td>
      <td>-0.006669</td>
      <td>0.047752</td>
      <td>-0.181241</td>
      <td>-0.031122</td>
      <td>-0.008871</td>
      <td>0.015825</td>
      <td>0.215735</td>
    </tr>
    <tr>
      <th>stim</th>
      <td>532.0</td>
      <td>0.013748</td>
      <td>0.123179</td>
      <td>-0.255486</td>
      <td>-0.062378</td>
      <td>-0.022202</td>
      <td>0.058143</td>
      <td>0.564985</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>Here is a box plot of the signal for these groups.</p>
<div class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>sns.catplot(fmri,</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">"event"</span>, y<span class="op">=</span><span class="st">"signal"</span>,</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>    kind<span class="op">=</span><span class="st">"box"</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="stats_files/figure-html/cell-39-output-1.png" width="469" height="468"></p>
</div>
</div>
<p>The dots lying outside the whiskers in the plot may be considered outliers. They are determined by the quartiles. Let <span class="math inline">\(Q_1\)</span> and <span class="math inline">\(Q_3\)</span> be the first and third quartiles (i.e., 25% and 75% percentiles), and let <span class="math inline">\(I=Q_3-Q_1\)</span> be the interquartile range (IQR). Then <span class="math inline">\(x\)</span> is an outlier value if</p>
<p><span class="math display">\[
x &lt; Q_1 - 1.5I \text{ or } x &gt; Q_3 + 1.5I.
\]</span></p>
</section>
<section id="mean-and-std" class="level3" data-number="2.4.2">
<h3 data-number="2.4.2" class="anchored" data-anchor-id="mean-and-std"><span class="header-section-number">2.4.2</span> Mean and STD</h3>
<p>For normal distributions, values more than twice the standard deviation <span class="math inline">\(\sigma\)</span> from the mean might be declared to be outliers; this would exclude 5% of the values, on average. A less aggressive criterion is to allow a distance of <span class="math inline">\(3\sigma\)</span>, which excludes only about 0.3% of the values. The IQR criterion above corresponds to about <span class="math inline">\(2.7\sigma\)</span> in the normal case.</p>
<p>The following plot shows the outlier cutoffs for 2000 samples from a normal distribution, using the criteria for 2σ (red), 3σ (blue), and 1.5 IQR (black).</p>
<div class="cell" data-execution_count="40">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> numpy.random <span class="im">import</span> default_rng</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>randn <span class="op">=</span> default_rng(<span class="dv">1</span>).normal </span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> pd.Series(randn(size<span class="op">=</span><span class="dv">2000</span>))</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>sns.displot(data<span class="op">=</span>x,bins<span class="op">=</span><span class="dv">30</span>)<span class="op">;</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>m,s <span class="op">=</span> x.mean(),x.std()</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>plt.axvline(m<span class="op">-</span><span class="dv">2</span><span class="op">*</span>s,color<span class="op">=</span><span class="st">'r'</span>)</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>plt.axvline(m<span class="op">+</span><span class="dv">2</span><span class="op">*</span>s,color<span class="op">=</span><span class="st">'r'</span>)</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>plt.axvline(m<span class="op">-</span><span class="dv">3</span><span class="op">*</span>s,color<span class="op">=</span><span class="st">'b'</span>)</span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>plt.axvline(m<span class="op">+</span><span class="dv">3</span><span class="op">*</span>s,color<span class="op">=</span><span class="st">'b'</span>)</span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>q1,q3 <span class="op">=</span> x.quantile([<span class="fl">.25</span>,<span class="fl">.75</span>])</span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>plt.axvline(q3<span class="op">+</span><span class="fl">1.5</span><span class="op">*</span>(q3<span class="op">-</span>q1),color<span class="op">=</span><span class="st">'k'</span>)</span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>plt.axvline(q1<span class="op">-</span><span class="fl">1.5</span><span class="op">*</span>(q3<span class="op">-</span>q1),color<span class="op">=</span><span class="st">'k'</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="stats_files/figure-html/cell-40-output-1.png" width="469" height="469"></p>
</div>
</div>
<p>For asymmetric distributions, or those with a heavy tail, these criteria might show greater differences.</p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>A criticism of classical statistics is that much of it is conditioned on the assumption of normally distributed variables. This assumption is often violated by real datasets, and quantities that depend on normality should be used judiciously.</p>
</div>
</div>
</section>
<section id="removing-outliers" class="level3" data-number="2.4.3">
<h3 data-number="2.4.3" class="anchored" data-anchor-id="removing-outliers"><span class="header-section-number">2.4.3</span> Removing outliers</h3>
<p>It is well known that the mean is more sensitive to outliers than the median is.</p>
<div id="exm-stats-median-mean" class="theorem example">
<p><span class="theorem-title"><strong>Example 2.13 </strong></span>The values <span class="math inline">\(1,2,3,4,5\)</span> have a mean and median both equal to 3. If we change the largest value to be a lot larger, say <span class="math inline">\(1,2,3,4,1000\)</span>, then the mean changes to 202. But the median is still 3!</p>
</div>
<p>Let’s use IQR to remove outliers from the fmri data set. We do this by creating a Boolean-valued series indicating which rows of the frame represent outliers within their group.</p>
<div class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> is_outlier(x):</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>    Q1,Q3 <span class="op">=</span> x.quantile([<span class="fl">.25</span>,<span class="fl">.75</span>])</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>    I <span class="op">=</span> Q3<span class="op">-</span>Q1</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (x <span class="op">&lt;</span> Q1<span class="op">-</span><span class="fl">1.5</span><span class="op">*</span>I) <span class="op">|</span>  (x <span class="op">&gt;</span> Q3<span class="op">+</span><span class="fl">1.5</span><span class="op">*</span>I)</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>outs <span class="op">=</span> fmri.groupby(<span class="st">"event"</span>)[<span class="st">"signal"</span>].transform(is_outlier)</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>fmri[outs][<span class="st">"event"</span>].value_counts()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="40">
<pre><code>stim    40
cue     26
Name: event, dtype: int64</code></pre>
</div>
</div>
<p>You can see above that there are 66 outliers. To negate the outlier indicator, we can use <code>~outs</code> as a row selector.</p>
<div class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>cleaned <span class="op">=</span> fmri[<span class="op">~</span>outs]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The median values are barely affected by the omission of the outliers.</p>
<div class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>( <span class="st">"medians with outliers:"</span> )</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>( fmri.groupby(<span class="st">"event"</span>)[<span class="st">"signal"</span>].median() )</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>( <span class="st">"</span><span class="ch">\n</span><span class="st">medians without outliers:"</span> )</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>( cleaned.groupby(<span class="st">"event"</span>)[<span class="st">"signal"</span>].median() )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>medians with outliers:
event
cue    -0.008871
stim   -0.022202
Name: signal, dtype: float64

medians without outliers:
event
cue    -0.009006
stim   -0.028068
Name: signal, dtype: float64</code></pre>
</div>
</div>
<p>The means show much greater change.</p>
<div class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>( <span class="st">"means with outliers:"</span> )</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>( fmri.groupby(<span class="st">"event"</span>)[<span class="st">"signal"</span>].mean() )</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>( <span class="st">"</span><span class="ch">\n</span><span class="st">means without outliers:"</span> )</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>( cleaned.groupby(<span class="st">"event"</span>)[<span class="st">"signal"</span>].mean() )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>means with outliers:
event
cue    -0.006669
stim    0.013748
Name: signal, dtype: float64

means without outliers:
event
cue    -0.008243
stim   -0.010245
Name: signal, dtype: float64</code></pre>
</div>
</div>
<p>For the <em>stim</em> case in particular, the mean value changes by almost 200%, including a sign change. (Relative to the standard deviation, it’s closer to a 20% change.) <!-- 
## Combine

It's common to form chains of operations that can be written separately or in one line. For example, consider the task of **imputation**, which is the replacement of missing values by a standard value such as the mean or median. In the penguin dataset, there are two rows with missing numerical values:

::: {.cell execution_count=45}
``` {.python .cell-code}
bills = ["bill_length_mm","bill_depth_mm"]
penguins[bills].isna().sum()
```

::: {.cell-output .cell-output-display execution_count=44}
```
bill_length_mm    2
bill_depth_mm     2
dtype: int64
```
:::
:::


Given variations between species, we probably want to compute values aggregated by species. 

::: {.cell execution_count=46}
``` {.python .cell-code}
by_species = penguins.groupby("species")
by_species[bills].median()
```

::: {.cell-output .cell-output-display execution_count=45}

```{=html}
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>bill_length_mm</th>
      <th>bill_depth_mm</th>
    </tr>
    <tr>
      <th>species</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Adelie</th>
      <td>38.80</td>
      <td>18.40</td>
    </tr>
    <tr>
      <th>Chinstrap</th>
      <td>49.55</td>
      <td>18.45</td>
    </tr>
    <tr>
      <th>Gentoo</th>
      <td>47.30</td>
      <td>15.00</td>
    </tr>
  </tbody>
</table>
</div>
```

:::
:::


In order to operate columnwise, we apply a custom transformation function using the `fillna` method to replace missing values. 

::: {.cell execution_count=47}
``` {.python .cell-code}
def impute(col):
    return col.fillna(col.median())

replaced = by_species[bills].transform(impute)
replaced
```

::: {.cell-output .cell-output-display execution_count=46}

```{=html}
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>bill_length_mm</th>
      <th>bill_depth_mm</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>39.1</td>
      <td>18.7</td>
    </tr>
    <tr>
      <th>1</th>
      <td>39.5</td>
      <td>17.4</td>
    </tr>
    <tr>
      <th>2</th>
      <td>40.3</td>
      <td>18.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>38.8</td>
      <td>18.4</td>
    </tr>
    <tr>
      <th>4</th>
      <td>36.7</td>
      <td>19.3</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>339</th>
      <td>47.3</td>
      <td>15.0</td>
    </tr>
    <tr>
      <th>340</th>
      <td>46.8</td>
      <td>14.3</td>
    </tr>
    <tr>
      <th>341</th>
      <td>50.4</td>
      <td>15.7</td>
    </tr>
    <tr>
      <th>342</th>
      <td>45.2</td>
      <td>14.8</td>
    </tr>
    <tr>
      <th>343</th>
      <td>49.9</td>
      <td>16.1</td>
    </tr>
  </tbody>
</table>
<p>344 rows × 2 columns</p>
</div>
```

:::
:::


Replacement has happened in the row with index 3, for example. Finally, we can overwrite the columns of the original data frame, if we don't care to know in the future which values were imputed. All of the necessary steps can be compressed into one chain:

::: {.cell execution_count=48}
``` {.python .cell-code}
penguins[bills] = penguins.groupby("species")[bills].transform(lambda x: x.fillna(x.median()))
penguins
```

::: {.cell-output .cell-output-display execution_count=47}

```{=html}
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>species</th>
      <th>island</th>
      <th>bill_length_mm</th>
      <th>bill_depth_mm</th>
      <th>flipper_length_mm</th>
      <th>body_mass_g</th>
      <th>sex</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Adelie</td>
      <td>Torgersen</td>
      <td>39.1</td>
      <td>18.7</td>
      <td>181.0</td>
      <td>3750.0</td>
      <td>Male</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Adelie</td>
      <td>Torgersen</td>
      <td>39.5</td>
      <td>17.4</td>
      <td>186.0</td>
      <td>3800.0</td>
      <td>Female</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Adelie</td>
      <td>Torgersen</td>
      <td>40.3</td>
      <td>18.0</td>
      <td>195.0</td>
      <td>3250.0</td>
      <td>Female</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Adelie</td>
      <td>Torgersen</td>
      <td>38.8</td>
      <td>18.4</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Adelie</td>
      <td>Torgersen</td>
      <td>36.7</td>
      <td>19.3</td>
      <td>193.0</td>
      <td>3450.0</td>
      <td>Female</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>339</th>
      <td>Gentoo</td>
      <td>Biscoe</td>
      <td>47.3</td>
      <td>15.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>340</th>
      <td>Gentoo</td>
      <td>Biscoe</td>
      <td>46.8</td>
      <td>14.3</td>
      <td>215.0</td>
      <td>4850.0</td>
      <td>Female</td>
    </tr>
    <tr>
      <th>341</th>
      <td>Gentoo</td>
      <td>Biscoe</td>
      <td>50.4</td>
      <td>15.7</td>
      <td>222.0</td>
      <td>5750.0</td>
      <td>Male</td>
    </tr>
    <tr>
      <th>342</th>
      <td>Gentoo</td>
      <td>Biscoe</td>
      <td>45.2</td>
      <td>14.8</td>
      <td>212.0</td>
      <td>5200.0</td>
      <td>Female</td>
    </tr>
    <tr>
      <th>343</th>
      <td>Gentoo</td>
      <td>Biscoe</td>
      <td>49.9</td>
      <td>16.1</td>
      <td>213.0</td>
      <td>5400.0</td>
      <td>Male</td>
    </tr>
  </tbody>
</table>
<p>344 rows × 7 columns</p>
</div>
```

:::
:::


 --></p>
</section>
</section>
<section id="correlation" class="level2 page-columns page-full" data-number="2.5">
<h2 data-number="2.5" class="anchored" data-anchor-id="correlation"><span class="header-section-number">2.5</span> Correlation</h2>
<!-- For illustrations, let's load the penguin dataset:

import pandas as pd
import seaborn as sns
penguins = sns.load_dataset("penguins").dropna()
penguins.head()
-->
<p>There are often observations that we believe to be linked, either because one influences the other, or both are influenced by some other factor. That is, we say the quantities are <em>correlated</em>.</p>
<p>There are several ways to measure correlation, but it’s good practice to look at the data before jumping to the numbers.</p>
<section id="relational-plots" class="level3 page-columns page-full" data-number="2.5.1">
<h3 data-number="2.5.1" class="anchored" data-anchor-id="relational-plots"><span class="header-section-number">2.5.1</span> Relational plots</h3>
<p>We can use <code>relplot</code> to make a scatter plot of two different columns in a frame:</p>
<div class="cell" data-execution_count="49">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>sns.relplot(cars, </span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">"model_year"</span>, y<span class="op">=</span><span class="st">"mpg"</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="stats_files/figure-html/cell-49-output-1.png" width="469" height="468"></p>
</div>
</div>
<p>Like the other plot types above, we can use color, column, marker size, etc. to separate the dots into groups.</p>
<p>If we want to emphasize a trend, we can instead plot the average value at each <span class="math inline">\(x\)</span> with error bars:</p>
<div class="cell" data-execution_count="50">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>sns.relplot(cars, </span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">"model_year"</span>, y<span class="op">=</span><span class="st">"mpg"</span>,</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>    kind<span class="op">=</span><span class="st">"line"</span>, errorbar<span class="op">=</span><span class="st">"sd"</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="stats_files/figure-html/cell-50-output-1.png" width="469" height="468"></p>
</div>
</div>
<p>The error ribbon above is drawn at one standard deviation around the mean.</p>
<p>In order to see multiple pairwise scatter plots, we can use <code>pairplot</code> in seaborn:</p>
<div class="cell page-columns page-full" data-execution_count="51">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>columns <span class="op">=</span> [ <span class="st">"mpg"</span>, <span class="st">"horsepower"</span>, <span class="st">"displacement"</span>, <span class="st">"origin"</span> ]</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>sns.pairplot( cars[columns],</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>    hue<span class="op">=</span><span class="st">"origin"</span>, height<span class="op">=</span><span class="dv">2</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display column-body-outset">
<p><img src="stats_files/figure-html/cell-51-output-1.png" width="669" height="568"></p>
</div>
</div>
<p>The panels along the diagonal show each quantitative variable’s PDF. The other panels show scatter plots putting one pair at a time of the variables on the coordinate axes.</p>
</section>
<section id="covariance" class="level3" data-number="2.5.2">
<h3 data-number="2.5.2" class="anchored" data-anchor-id="covariance"><span class="header-section-number">2.5.2</span> Covariance</h3>
<div id="def-stats-covariance" class="theorem definition">
<p><span class="theorem-title"><strong>Definition 2.10 </strong></span>Suppose we have two series of observations, <span class="math inline">\([x_i]\)</span> and <span class="math inline">\([y_i]\)</span>, representing observations of random quantities <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> having means <span class="math inline">\(\mu_X\)</span> and <span class="math inline">\(\mu_Y\)</span>. Their <strong>covariance</strong> is defined as <span class="math display">\[
\Cov(X,Y) = \frac{1}{n} \sum_{i=1}^n (x_i-\mu_X)(y_i-\mu_Y).
\]</span></p>
</div>
<p>Note that the values <span class="math inline">\(x_i-\mu_X\)</span> and <span class="math inline">\(y_i-\mu_Y\)</span> are deviations from the means. It follows from the definitions that <span class="math display">\[
\begin{split}
    \Cov(X,X) &amp;= \sigma_X^2, \\
    \Cov(Y,Y) &amp;= \sigma_Y^2,
\end{split}
\]</span> i.e., self-covariance is simply variance.</p>
<p>Covariance is not easy to interpret. Its units are the products of the units of the two variables, and it is sensitive to rescaling the variables (e.g., grams versus kilograms).</p>
</section>
<section id="pearson-coefficient" class="level3" data-number="2.5.3">
<h3 data-number="2.5.3" class="anchored" data-anchor-id="pearson-coefficient"><span class="header-section-number">2.5.3</span> Pearson coefficient</h3>
<p>We can remove the dependence on units and scale by applying the covariance to standardized scores for both variables. The following is the best-known measure of correlation.</p>
<div id="def-stats-pearson" class="theorem definition">
<p><span class="theorem-title"><strong>Definition 2.11 </strong></span>For the populations of <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span>, the <strong>Pearson correlation coefficient</strong> is <span id="eq-stats-pearson-pop"><span class="math display">\[
\begin{split}
    \rho(X,Y) &amp;= \frac{1}{n} \sum_{i=1}^n \left(\frac{x_i-\mu_X}{\sigma_X}\right)\left(\frac{y_i-\mu_Y}{\sigma_Y}\right) \\
    &amp; = \frac{\Cov(X,Y)}{\sigma_X\sigma_Y},
\end{split}
\tag{2.9}\]</span></span> where <span class="math inline">\(\sigma_X^2\)</span> and <span class="math inline">\(\sigma_Y^2\)</span> are the population variances of <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span>.</p>
<p>For samples from the two populations, we use <span id="eq-stats-pearson-samp"><span class="math display">\[
r_{xy} =  \frac{\sum_{i=1}^n (x_i-\bar{x}) (y_i-\bar{y})}{\sqrt{\sum_{i=1}^n (x_i-\bar{x})^2}\,\sqrt{\sum_{i=1}^n (y_i-\bar{y})^2}},
\tag{2.10}\]</span></span> where <span class="math inline">\(\bar{x}\)</span> and <span class="math inline">\(\bar{y}\)</span> are sample means.</p>
</div>
<p>Both <span class="math inline">\(\rho_{XY}\)</span> and <span class="math inline">\(r_{xy}\)</span> are between <span class="math inline">\(-1\)</span> and <span class="math inline">\(1\)</span>, with the endpoints indicating perfect correlation (inverse or direct).</p>
<p>An equivalent formula for <span class="math inline">\(r_{xy}\)</span> is <span id="eq-stats-pearson-alt"><span class="math display">\[
r_{xy} =  \frac{1}{n-1} \sum_{i=1}^n \left(\frac{x_i-\bar{x}}{s_x}\right)\, \left(\frac{y_i-\bar{y}}{s_y}\right),
\tag{2.11}\]</span></span> where the quantities in parentheses are z-scores.</p>
<div id="exm-stats-pearson-cars" class="theorem example">
<p><span class="theorem-title"><strong>Example 2.14 </strong></span>We might reasonably expect horsepower and miles per gallon to be inversely correlated:</p>
<div class="cell" data-execution_count="52">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>sns.relplot( data<span class="op">=</span>cars,</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">"horsepower"</span>,y<span class="op">=</span><span class="st">"mpg"</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="stats_files/figure-html/cell-52-output-1.png" width="469" height="468"></p>
</div>
</div>
<p>Covariance allows us to confirm the relationship:</p>
<div class="cell" data-execution_count="53">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>cars[ [<span class="st">"horsepower"</span>, <span class="st">"mpg"</span>] ].cov()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="52">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>horsepower</th>
      <th>mpg</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>horsepower</th>
      <td>1481.569393</td>
      <td>-233.857926</td>
    </tr>
    <tr>
      <th>mpg</th>
      <td>-233.857926</td>
      <td>61.089611</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>But should these numbers considered big? The Pearson coefficient is more helpful:</p>
<div class="cell" data-execution_count="54">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>cars[ [<span class="st">"horsepower"</span>, <span class="st">"mpg"</span>] ].corr()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="53">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>horsepower</th>
      <th>mpg</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>horsepower</th>
      <td>1.000000</td>
      <td>-0.778427</td>
    </tr>
    <tr>
      <th>mpg</th>
      <td>-0.778427</td>
      <td>1.000000</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>The value of about <span class="math inline">\(-0.79\)</span> suggests that knowing one of the values would allow us to predict the other one rather well using a best-fit straight line (more on that in a future chapter).</p>
</div>
<p>As usual when dealing with means, however, the Pearson coefficient can be sensitive to outlier values.</p>
<div id="exm-stats-pearson-outlier" class="theorem example">
<p><span class="theorem-title"><strong>Example 2.15 </strong></span>The Pearson coefficient of any variable with itself is 1. But let’s correlate two series that differ in only one element: <span class="math inline">\(0,1,2,\ldots,19\)</span>, and the same sequence but with the fifth value replaced by <span class="math inline">\(-100\)</span>:</p>
<div class="cell" data-execution_count="55">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> pd.Series( <span class="bu">range</span>(<span class="dv">20</span>) )</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> x.copy()</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>y[<span class="dv">4</span>] <span class="op">=</span> <span class="op">-</span><span class="dv">100</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>x.corr(y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="54">
<pre><code>0.43636501543147005</code></pre>
</div>
</div>
<p>Despite the change being in a single value, over half of the predictive power was lost.</p>
</div>
</section>
<section id="spearman-coefficient" class="level3" data-number="2.5.4">
<h3 data-number="2.5.4" class="anchored" data-anchor-id="spearman-coefficient"><span class="header-section-number">2.5.4</span> Spearman coefficient</h3>
<p>The Spearman coefficient is one way to lessen the impact of outliers when measuring correlation. The idea is that the values are used only in their orderings.</p>
<div id="def-stats-rank-series" class="theorem definition">
<p><span class="theorem-title"><strong>Definition 2.12 </strong></span>If <span class="math inline">\(x_1,\ldots,x_n\)</span> is a series of observations, let their sorted ordering be <span class="math display">\[
x_{s_1},x_{s_2},\ldots,x_{s_n}.
\]</span> Then <span class="math inline">\(s_1,s_2,\ldots,s_n\)</span> is the <strong>rank series</strong> of <span class="math inline">\(\bfx\)</span>.</p>
</div>
<div id="def-stats-spearman" class="theorem definition">
<p><span class="theorem-title"><strong>Definition 2.13 </strong></span>The <strong>Spearman coefficient</strong> of two series of equal length is the Pearson coefficient of their rank series.</p>
</div>
<div id="exm-stats-spearman-outlier" class="theorem example">
<p><span class="theorem-title"><strong>Example 2.16 </strong></span>Returning to <a href="#exm-stats-pearson-outlier">Example&nbsp;<span>2.15</span></a>, we find the Spearman coefficient is barely affected by the single outlier:</p>
<div class="cell" data-execution_count="56">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> pd.Series( <span class="bu">range</span>(<span class="dv">20</span>) )</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> x.copy()</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>y[<span class="dv">4</span>] <span class="op">=</span> <span class="op">-</span><span class="dv">100</span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>x.corr(y,<span class="st">"spearman"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="55">
<pre><code>0.9849624060150375</code></pre>
</div>
</div>
<p>It’s trivial in this case to produce the two rank series by hand:</p>
<div class="cell" data-execution_count="57">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>s <span class="op">=</span> pd.Series( <span class="bu">range</span>(<span class="dv">1</span>,<span class="dv">21</span>) )    <span class="co"># already sorted</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>t <span class="op">=</span> s.copy()</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>t[:<span class="dv">5</span>] <span class="op">=</span> [<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">1</span>]     <span class="co"># modified sort ordering</span></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>t.corr(s)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="56">
<pre><code>0.9849624060150375</code></pre>
</div>
</div>
<p>As long as <code>y[4]</code> is negative, it doesn’t matter what its particular value is:</p>
<div class="cell" data-execution_count="58">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>y[<span class="dv">4</span>] <span class="op">=</span> <span class="op">-</span><span class="dv">1000000</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>x.corr(y,<span class="st">"spearman"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="57">
<pre><code>0.9849624060150375</code></pre>
</div>
</div>
</div>
<p>Since real data almost always features outlying or anomalous values, it’s important to think about the robustness of the statistics you choose.</p>
</section>
<section id="categorical-correlation" class="level3" data-number="2.5.5">
<h3 data-number="2.5.5" class="anchored" data-anchor-id="categorical-correlation"><span class="header-section-number">2.5.5</span> Categorical correlation</h3>
<p>An ordinal variable, such as the days of the week, is often straightforward to quantify as integers. But a nominal variable poses a different challenge.</p>
<div id="exm-stats-catcorr" class="theorem example">
<p><span class="theorem-title"><strong>Example 2.17 </strong></span>Grouped histograms suggest an association between country of origin and MPG:</p>
<div class="cell" data-execution_count="59">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>sns.displot(data<span class="op">=</span>cars, kind<span class="op">=</span><span class="st">"kde"</span>,</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">"mpg"</span>, hue<span class="op">=</span><span class="st">"origin"</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="stats_files/figure-html/cell-59-output-1.png" width="572" height="468"></p>
</div>
</div>
<p>How can we quantify the association? The first step is to convert the <em>origin</em> column into dummy variables:</p>
<div class="cell" data-execution_count="60">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>dum <span class="op">=</span> pd.get_dummies(cars, columns<span class="op">=</span>[<span class="st">"origin"</span>])</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>dum.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="59">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>mpg</th>
      <th>cylinders</th>
      <th>displacement</th>
      <th>horsepower</th>
      <th>weight</th>
      <th>acceleration</th>
      <th>model_year</th>
      <th>name</th>
      <th>mpg_z</th>
      <th>cuts</th>
      <th>group_z</th>
      <th>global_z</th>
      <th>origin_europe</th>
      <th>origin_japan</th>
      <th>origin_usa</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>18.0</td>
      <td>8</td>
      <td>307.0</td>
      <td>130.0</td>
      <td>3504</td>
      <td>12.0</td>
      <td>70</td>
      <td>chevrolet chevelle malibu</td>
      <td>-0.705551</td>
      <td>(3500, 4500]</td>
      <td>0.837535</td>
      <td>-0.705551</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>15.0</td>
      <td>8</td>
      <td>350.0</td>
      <td>165.0</td>
      <td>3693</td>
      <td>11.5</td>
      <td>70</td>
      <td>buick skylark 320</td>
      <td>-1.089379</td>
      <td>(3500, 4500]</td>
      <td>-0.249252</td>
      <td>-1.089379</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>18.0</td>
      <td>8</td>
      <td>318.0</td>
      <td>150.0</td>
      <td>3436</td>
      <td>11.0</td>
      <td>70</td>
      <td>plymouth satellite</td>
      <td>-0.705551</td>
      <td>(2500, 3500]</td>
      <td>-0.956484</td>
      <td>-0.705551</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>3</th>
      <td>16.0</td>
      <td>8</td>
      <td>304.0</td>
      <td>150.0</td>
      <td>3433</td>
      <td>12.0</td>
      <td>70</td>
      <td>amc rebel sst</td>
      <td>-0.961437</td>
      <td>(2500, 3500]</td>
      <td>-1.377177</td>
      <td>-0.961437</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>4</th>
      <td>17.0</td>
      <td>8</td>
      <td>302.0</td>
      <td>140.0</td>
      <td>3449</td>
      <td>10.5</td>
      <td>70</td>
      <td>ford torino</td>
      <td>-0.833494</td>
      <td>(2500, 3500]</td>
      <td>-1.166831</td>
      <td>-0.833494</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>The original <em>origin</em> column has been replaced by three binary indicator columns. Now we can look for correlations between them and <em>mpg</em>:</p>
<div class="cell" data-execution_count="61">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>columns <span class="op">=</span> [</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mpg"</span>,</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"origin_europe"</span>,</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"origin_japan"</span>,</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"origin_usa"</span></span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>dum[columns].corr()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="60">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>mpg</th>
      <th>origin_europe</th>
      <th>origin_japan</th>
      <th>origin_usa</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>mpg</th>
      <td>1.000000</td>
      <td>0.259022</td>
      <td>0.442174</td>
      <td>-0.568192</td>
    </tr>
    <tr>
      <th>origin_europe</th>
      <td>0.259022</td>
      <td>1.000000</td>
      <td>-0.229895</td>
      <td>-0.597198</td>
    </tr>
    <tr>
      <th>origin_japan</th>
      <td>0.442174</td>
      <td>-0.229895</td>
      <td>1.000000</td>
      <td>-0.643317</td>
    </tr>
    <tr>
      <th>origin_usa</th>
      <td>-0.568192</td>
      <td>-0.597198</td>
      <td>-0.643317</td>
      <td>1.000000</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>As you can see from the above, <code>europe</code> and <code>japan</code> are positively associated with <em>mpg</em>, while <code>usa</code> is inversely associated with <em>mpg</em>.</p>
</div>
</section>
</section>
<section id="cautionary-tales" class="level2 page-columns page-full" data-number="2.6">
<h2 data-number="2.6" class="anchored" data-anchor-id="cautionary-tales"><span class="header-section-number">2.6</span> Cautionary tales</h2>
<p>Attaching theorem-supported numbers to real data feels precise and infallible. The theorems do what they say, of course—they’re theorems—but our intuition can be a little too ready to attach significance to the numbers, causing misconceptions or mistakes. Proper visualizations can help us see through such issues.</p>
<section id="anscombes-quartet" class="level3 page-columns page-full" data-number="2.6.1">
<h3 data-number="2.6.1" class="anchored" data-anchor-id="anscombes-quartet"><span class="header-section-number">2.6.1</span> Anscombe’s quartet</h3>
<p>In 1973, Francis Anscombe created four artificial datasets in order to illustrate the perils of trusting a few numbers to describe sets of observations. These have been made available in seaborn:</p>
<div class="cell" data-execution_count="62">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>quartet <span class="op">=</span> sns.load_dataset(<span class="st">"anscombe"</span>)</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>quartet.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="61">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>dataset</th>
      <th>x</th>
      <th>y</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>I</td>
      <td>10.0</td>
      <td>8.04</td>
    </tr>
    <tr>
      <th>1</th>
      <td>I</td>
      <td>8.0</td>
      <td>6.95</td>
    </tr>
    <tr>
      <th>2</th>
      <td>I</td>
      <td>13.0</td>
      <td>7.58</td>
    </tr>
    <tr>
      <th>3</th>
      <td>I</td>
      <td>9.0</td>
      <td>8.81</td>
    </tr>
    <tr>
      <th>4</th>
      <td>I</td>
      <td>11.0</td>
      <td>8.33</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>Both the <em>x</em> and <em>y</em> variables have identical means and variances across all four of the sets:</p>
<div class="cell" data-execution_count="63">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>by_set <span class="op">=</span> quartet.groupby(<span class="st">"dataset"</span>)</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>by_set.mean()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="62">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>x</th>
      <th>y</th>
    </tr>
    <tr>
      <th>dataset</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>I</th>
      <td>9.0</td>
      <td>7.500909</td>
    </tr>
    <tr>
      <th>II</th>
      <td>9.0</td>
      <td>7.500909</td>
    </tr>
    <tr>
      <th>III</th>
      <td>9.0</td>
      <td>7.500000</td>
    </tr>
    <tr>
      <th>IV</th>
      <td>9.0</td>
      <td>7.500909</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="64">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>by_set.std()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="63">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>x</th>
      <th>y</th>
    </tr>
    <tr>
      <th>dataset</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>I</th>
      <td>3.316625</td>
      <td>2.031568</td>
    </tr>
    <tr>
      <th>II</th>
      <td>3.316625</td>
      <td>2.031657</td>
    </tr>
    <tr>
      <th>III</th>
      <td>3.316625</td>
      <td>2.030424</td>
    </tr>
    <tr>
      <th>IV</th>
      <td>3.316625</td>
      <td>2.030579</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>It follows that the correlations within each set are also identical:</p>
<div class="cell" data-execution_count="65">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>by_set.corr()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="64">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th></th>
      <th>x</th>
      <th>y</th>
    </tr>
    <tr>
      <th>dataset</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="2" valign="top">I</th>
      <th>x</th>
      <td>1.000000</td>
      <td>0.816421</td>
    </tr>
    <tr>
      <th>y</th>
      <td>0.816421</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">II</th>
      <th>x</th>
      <td>1.000000</td>
      <td>0.816237</td>
    </tr>
    <tr>
      <th>y</th>
      <td>0.816237</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">III</th>
      <th>x</th>
      <td>1.000000</td>
      <td>0.816287</td>
    </tr>
    <tr>
      <th>y</th>
      <td>0.816287</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">IV</th>
      <th>x</th>
      <td>1.000000</td>
      <td>0.816521</td>
    </tr>
    <tr>
      <th>y</th>
      <td>0.816521</td>
      <td>1.000000</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>Yet scatter plots reveal that the sets are drastically different:</p>
<div class="cell page-columns page-full" data-execution_count="66">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>sns.relplot( data<span class="op">=</span>quartet, </span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">"x"</span>, y<span class="op">=</span><span class="st">"y"</span>, </span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>    col<span class="op">=</span><span class="st">"dataset"</span>, col_wrap<span class="op">=</span><span class="dv">2</span>, height<span class="op">=</span><span class="fl">2.2</span></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display column-body-outset-right">
<p><img src="stats_files/figure-html/cell-66-output-1.png" width="412" height="410"></p>
</div>
</div>
<p>Anscombe’s quartet shows that a few summary statistics are not able to capture everything important about even a small dataset.</p>
</section>
<section id="simpsons-paradox" class="level3" data-number="2.6.2">
<h3 data-number="2.6.2" class="anchored" data-anchor-id="simpsons-paradox"><span class="header-section-number">2.6.2</span> Simpson’s paradox</h3>
<p>The penguin dataset contains a common paradox (well, a counterintuitive phenomenon, anyway). Two of the variables show a fairly strong negative correlation:</p>
<div class="cell" data-execution_count="67">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>penguins <span class="op">=</span> sns.load_dataset(<span class="st">"penguins"</span>)</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>columns <span class="op">=</span> [ <span class="st">"body_mass_g"</span>, <span class="st">"bill_depth_mm"</span> ]</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>penguins[columns].corr()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="66">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>body_mass_g</th>
      <th>bill_depth_mm</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>body_mass_g</th>
      <td>1.000000</td>
      <td>-0.471916</td>
    </tr>
    <tr>
      <th>bill_depth_mm</th>
      <td>-0.471916</td>
      <td>1.000000</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>But something surprising happens if we compute correlations <em>after</em> grouping by species.</p>
<div class="cell" data-execution_count="68">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>penguins.groupby(<span class="st">"species"</span>)[columns].corr()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="67">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th></th>
      <th>body_mass_g</th>
      <th>bill_depth_mm</th>
    </tr>
    <tr>
      <th>species</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="2" valign="top">Adelie</th>
      <th>body_mass_g</th>
      <td>1.000000</td>
      <td>0.576138</td>
    </tr>
    <tr>
      <th>bill_depth_mm</th>
      <td>0.576138</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">Chinstrap</th>
      <th>body_mass_g</th>
      <td>1.000000</td>
      <td>0.604498</td>
    </tr>
    <tr>
      <th>bill_depth_mm</th>
      <td>0.604498</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">Gentoo</th>
      <th>body_mass_g</th>
      <td>1.000000</td>
      <td>0.719085</td>
    </tr>
    <tr>
      <th>bill_depth_mm</th>
      <td>0.719085</td>
      <td>1.000000</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>Within each individual species, the correlation between the variables is strongly positive!</p>
<p>This is an example of <strong>Simpson’s paradox</strong>. The reason for it can be seen from a scatter plot:</p>
<div class="cell" data-execution_count="69">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>sns.relplot(penguins,</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span>columns[<span class="dv">0</span>], y<span class="op">=</span>columns[<span class="dv">1</span>], </span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>    hue<span class="op">=</span><span class="st">"species"</span></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="stats_files/figure-html/cell-69-output-1.png" width="575" height="468"></p>
</div>
</div>
<p>Within each color, the positive association is clear. But what dominates the combination of all three species is the large difference between Gentoo and the others. Because the Gentoo are both larger and have shallower bills, the dominant relationship is negative.</p>
<p>As often happens in statistics, the precise framing of the question can strongly affect its answer. This can lead to honest mistakes by the naive as well as outright deception by the unscrupulous.</p>
</section>
</section>
<section id="exercises" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="exercises">Exercises</h2>
<p>For these exercises, you may of course use computer help to work on a problem, but your answer should be self-contained without reference to computer output (unless stated otherwise).</p>
<div id="exr-stats-summary" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 2.1 </strong></span>For <span class="math inline">\(n&gt;2\)</span>, let <span class="math inline">\(x_i=0\)</span> for <span class="math inline">\(i=1,\ldots,n-1\)</span>, and <span class="math inline">\(x_n=M&gt;0\)</span>. Find the <strong>(a)</strong> sample mean, <strong>(b)</strong> sample median, <strong>(c)</strong> corrected sample variance <span class="math inline">\(s_{n-1}^2\)</span>, and <strong>(d)</strong> sample z-scores of the <span class="math inline">\(x_i\)</span> in terms of <span class="math inline">\(M\)</span> and <span class="math inline">\(n\)</span>.</p>
</div>
<div id="exr-stats-z-scores" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 2.2 </strong></span>Suppose the samples <span class="math inline">\(x_1,\ldots,x_n\)</span> have z-scores <span class="math inline">\(z_1,\ldots,z_n\)</span>.</p>
<p><strong>(a)</strong> Show that <span class="math inline">\(\displaystyle \sum_{i=1}^n z_i = 0.\)</span></p>
<p><strong>(b)</strong> Show that <span class="math inline">\(\displaystyle \sum_{i=1}^n z_i^2 = n-1.\)</span></p>
</div>
<div id="exr-stats-outlier" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 2.3 </strong></span>For the sample set in <a href="#exr-stats-summary">Exercise&nbsp;<span>2.1</span></a>, find a value <span class="math inline">\(N\)</span> such that if <span class="math inline">\(n&gt;N\)</span>, there is at least one outlier according to the 2σ criterion.</p>
</div>
<div id="exr-stats-outlier-iqr" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 2.4 </strong></span>Define a population by</p>
<p><span class="math display">\[
x_i = \begin{cases}
1, &amp; 1 \le i \le 11, \\
2, &amp; 12 \le i \le 14,\\
4, &amp; 15 \le i \le 22, \\
6, &amp; 23 \le i \le 32.
\end{cases}
\]</span></p>
<p><strong>(a)</strong> Find the median of the population.</p>
<p><strong>(b)</strong> Which of the following are outliers according to the 1.5 IQR criterion?</p>
<p><span class="math display">\[-5,0,5,10,15,20\]</span></p>
</div>
<div id="exr-stats-least-squares" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 2.5 </strong></span>Suppose that a population has values <span class="math inline">\(x_1,x_2,\ldots,x_n\)</span>. Define the function</p>
<p><span class="math display">\[
r_2(x) = \sum_{i=1}^n (x_i-x)^2.
\]</span></p>
<p>Show that <span class="math inline">\(r_2\)</span> has a global minimum at <span class="math inline">\(x=\mu\)</span>, the population mean.</p>
</div>
<div id="exr-stats-least-mad" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 2.6 </strong></span>Suppose that <span class="math inline">\(n=2k+1\)</span> and a population has values <span class="math inline">\(x_1,x_2,\ldots,x_{n}\)</span> in sorted order, so that the median is equal to <span class="math inline">\(x_k\)</span>. Define the function</p>
<p><span class="math display">\[
r_1(x) = \sum_{i=1}^n |x_i-x|.
\]</span></p>
<p>(This function is the <em>total absolute deviation</em> of <span class="math inline">\(x\)</span> from the population.) Show that <span class="math inline">\(r_1\)</span> has a global minimum at <span class="math inline">\(x=x_k\)</span> by way of the following steps.</p>
<p><strong>(a)</strong> Explain why the derivative of <span class="math inline">\(r_1\)</span> is undefined at every <span class="math inline">\(x_i\)</span>. Consequently, all of the <span class="math inline">\(x_i\)</span> are critical points of <span class="math inline">\(r_1\)</span>.</p>
<p><strong>(b)</strong> Determine <span class="math inline">\(r_1'\)</span> within each piece of the real axis between the <span class="math inline">\(x_i\)</span>, and explain why there cannot be any additional critical points to consider. (Note: you can replace the absolute values with a piecewise definition of <span class="math inline">\(r_1\)</span>, where the formula for the pieces changes as you cross over each <span class="math inline">\(x_i\)</span>.)</p>
<p><strong>(c)</strong> By appealing to the derivative values between the <span class="math inline">\(x_i\)</span>, explain why it must be that</p>
<p><span class="math display">\[
r_1(x_1) &gt; r_1(x_2) &gt; \cdots &gt; r_1(x_k) &lt; r_1(x_{k+1}) &lt; \cdots &lt; r_1(x_n).
\]</span></p>
</div>
<div id="exr-stats-pearson-z" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 2.7 </strong></span>Prove that two sample sets have a Pearson correlation coefficient equal to 1 if they have identical z-scores. (Hint: See <a href="#exr-stats-z-scores">Exercise&nbsp;<span>2.2</span></a>.)</p>
</div>
<div id="exr-stats-pearson-anti" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 2.8 </strong></span>Suppose that two sample sets satisfy <span class="math inline">\(y_i=-x_i\)</span> for all <span class="math inline">\(i\)</span>. Prove that the Pearson correlation coefficient between <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span> equals <span class="math inline">\(-1\)</span>.</p>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./data.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Representation of data</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./classification.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Classification</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
 Data Science 1
  </li>  
</ul>
    </div>   
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
 Toby Driscoll
  </li>  
</ul>
    </div>
  </div>
</footer>



</body></html>